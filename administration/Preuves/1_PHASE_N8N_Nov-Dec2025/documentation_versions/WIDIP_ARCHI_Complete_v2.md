# ğŸ—ï¸ Architecture ComplÃ¨te WIDIP v2 - SystÃ¨me d'Automatisation IA

**Version** : 2.0  
**Auteur** : Maxime RIPOUTEAU  
**Date** : 01 DÃ©cembre 2024  
**Licence** : Apache 2.0  

---

## ğŸ“‹ Table des MatiÃ¨res

1. [Vue d'Ensemble](#1-vue-densemble)
2. [Architecture Globale v2](#2-architecture-globale-v2)
3. [Couche Infrastructure Redis](#3-couche-infrastructure-redis)
4. [Hub MCP Global](#4-hub-mcp-global)
5. [Workflow 1 : Proactif Observium v7](#5-workflow-1--proactif-observium-v7)
6. [Workflow 2 : Assist Ticket v3](#6-workflow-2--assist-ticket-v3)
7. [Workflow 3 : WIBOT (Assistant IA)](#7-workflow-3--wibot-assistant-ia)
8. [Workflows Infrastructure](#8-workflows-infrastructure)
9. [Services MCP (Sub-workflows)](#9-services-mcp-sub-workflows)
10. [SystÃ¨me de Queue LLM](#10-systÃ¨me-de-queue-llm)
11. [Matrice des DÃ©pendances](#11-matrice-des-dÃ©pendances)
12. [MÃ©triques & ObservabilitÃ©](#12-mÃ©triques--observabilitÃ©)
13. [Guide de DÃ©ploiement](#13-guide-de-dÃ©ploiement)

---

## 1. Vue d'Ensemble

### ğŸ¯ Contexte MÃ©tier

**WIDIP** est un hÃ©bergeur de donnÃ©es pour le secteur mÃ©dico-social avec :
- **800+ Ã©tablissements clients** (EHPAD, cliniques, associations)
- **~20 000 tickets de support / an**
- Infrastructure critique 24/7
- ConformitÃ© RGPD obligatoire

### ğŸ†• NouveautÃ©s v2

| FonctionnalitÃ© | v1 | v2 |
|----------------|----|----|
| Cache intelligent | âŒ | âœ… Redis (TTL 20min) |
| Circuit Breaker | âŒ | âœ… Mode dÃ©gradÃ© si API down |
| Mutex LLM | âŒ | âœ… Anti-collision GPU |
| Queue prioritÃ©s | âŒ | âœ… Proactif > Assist |
| Health Check | âŒ | âœ… Ping GLPI 30s |
| MÃ©triques Prometheus | Partiel | âœ… Complet |

### ğŸ§  Philosophie d'Architecture v2

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRINCIPES WIDIP v2                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Data Sovereignty    â†’ Tout en local (RGPD)                 â”‚
â”‚  2. Agent Autonomy      â†’ IA dÃ©cide et agit                    â”‚
â”‚  3. MCP Abstraction     â†’ APIs unifiÃ©es                        â”‚
â”‚  4. Fail-Safe Design    â†’ Circuit Breaker + Mode dÃ©gradÃ©       â”‚
â”‚  5. Observability       â†’ MÃ©triques Prometheus + Redis         â”‚
â”‚  6. Resource Protection â†’ Mutex LLM + Queue prioritÃ©s          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Architecture Globale v2

### ğŸ›ï¸ Vue d'Ensemble du SystÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           COUCHE PRÃ‰SENTATION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Chat Web UI   â”‚  â”‚  Webhook HTTP   â”‚  â”‚  Schedule Cron  â”‚             â”‚
â”‚  â”‚   (WIBOT)       â”‚  â”‚  (Observium)    â”‚  â”‚  (3 min poll)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                    â”‚                     â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                     â”‚
            â–¼                    â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COUCHE ORCHESTRATION (n8n)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   WIBOT_v1      â”‚  â”‚  Proactif_v7    â”‚  â”‚  Assist_v3      â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚ â€¢ RAG Chatbot   â”‚  â”‚ â€¢ Agent         â”‚  â”‚ â€¢ Agent         â”‚             â”‚
â”‚  â”‚ â€¢ Auth Matrix   â”‚  â”‚   Sentinel      â”‚  â”‚   Support       â”‚             â”‚
â”‚  â”‚ â€¢ Claude API    â”‚  â”‚ â€¢ Agent         â”‚  â”‚ â€¢ Auto-Reset    â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚   Notificateur  â”‚  â”‚ â€¢ Polling 3min  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                    â”‚                     â”‚                      â”‚
â”‚           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                      â”‚
â”‚           â”‚         â”‚  NOUVEAUTÃ‰S v2      â”‚          â”‚                      â”‚
â”‚           â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚                      â”‚
â”‚           â”‚         â”‚ â€¢ Check GLPI Health â”‚          â”‚                      â”‚
â”‚           â”‚         â”‚ â€¢ Acquire LLM Lock  â”‚          â”‚                      â”‚
â”‚           â”‚         â”‚ â€¢ Release LLM Lock  â”‚          â”‚                      â”‚
â”‚           â”‚         â”‚ â€¢ Cache Redis       â”‚          â”‚                      â”‚
â”‚           â”‚         â”‚ â€¢ Circuit Breaker   â”‚          â”‚                      â”‚
â”‚           â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                      â”‚
â”‚           â”‚                    â”‚                     â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                â”‚                                            â”‚
â”‚                         MCP Client Tools                                    â”‚
â”‚                                â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INFRASTRUCTURE  â”‚  â”‚   HUB MCP        â”‚  â”‚  SERVICES MCP    â”‚
â”‚  REDIS           â”‚  â”‚   GLOBAL v6      â”‚  â”‚  (6 sub-wf)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚ â€¢ Redis Helper   â”‚  â”‚ â€¢ MCP Triggers   â”‚  â”‚ â€¢ MCP_GLPI_v6    â”‚
â”‚ â€¢ Health Check   â”‚  â”‚ â€¢ Tool Routing   â”‚  â”‚ â€¢ MCP_Observium  â”‚
â”‚ â€¢ LLM Gateway    â”‚  â”‚ â€¢ Auth Header    â”‚  â”‚ â€¢ MCP_Phibee     â”‚
â”‚ â€¢ LLM Worker     â”‚  â”‚                  â”‚  â”‚ â€¢ MCP_SMTP       â”‚
â”‚ â€¢ LLM Result     â”‚  â”‚                  â”‚  â”‚ â€¢ MCP_AD         â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚ â€¢ MCP_MySecret   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COUCHE SERVICES EXTERNES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    Redis     â”‚  â”‚  GLPI API    â”‚  â”‚  Observium   â”‚  â”‚  Phibee API  â”‚    â”‚
â”‚  â”‚   :6379      â”‚  â”‚  REST        â”‚  â”‚  Monitoring  â”‚  â”‚  FAI         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SMTP Server  â”‚  â”‚ Active Dir.  â”‚  â”‚  MySecret    â”‚  â”‚  Ollama      â”‚    â”‚
â”‚  â”‚ (Email)      â”‚  â”‚ LDAP/SSH     â”‚  â”‚  API         â”‚  â”‚  :11434      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COUCHE INTELLIGENCE (Local)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                    Ollama (Local LLMs)                    â”‚              â”‚
â”‚  â”‚  â€¢ Qwen 2.5 14B     â†’ Proactif + Assist (principal)      â”‚              â”‚
â”‚  â”‚  â€¢ Mistral 7B       â†’ Fallback / tests                    â”‚              â”‚
â”‚  â”‚  â€¢ Claude Sonnet 4  â†’ WIBOT via Anthropic API            â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                    Bases de DonnÃ©es                       â”‚              â”‚
â”‚  â”‚  â€¢ PostgreSQL       â†’ Logs incidents, agent logs          â”‚              â”‚
â”‚  â”‚  â€¢ Redis            â†’ Cache, mutex, health status         â”‚              â”‚
â”‚  â”‚  â€¢ Vector Store     â†’ RAG embeddings (WIBOT)              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š Statistiques d'Architecture v2

| Composant | QuantitÃ© | Type | NouveautÃ© v2 |
|-----------|----------|------|--------------|
| Workflows Principaux | 3 | n8n | ModifiÃ©s |
| Workflows Infrastructure | 5 | n8n | âœ… Nouveau |
| Hub MCP Global | 1 | n8n | Mis Ã  jour |
| Sub-workflows MCP | 6 | n8n | +2 (AD, MySecret) |
| Agents IA | 4 | LangChain | OptimisÃ©s |
| MCP Servers | 6 | SSE/HTTP | - |
| Services Redis | 1 | Docker | âœ… Nouveau |
| LLMs | 3 | Ollama/API | - |

---

## 3. Couche Infrastructure Redis

### ğŸ—„ï¸ Vue d'Ensemble Redis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE REDIS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Redis Server                              â”‚ â”‚
â”‚  â”‚                     (Port 6379)                               â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  ClÃ©s utilisÃ©es:                                             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ glpi_health_status      â†’ ok | degraded | down          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ glpi_down_alert_sent    â†’ flag anti-spam                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ llm_mutex               â†’ lock exclusif GPU             â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ phibee_diag_{device}    â†’ cache diagnostics (TTL 20min) â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ llm_queue               â†’ Sorted Set prioritÃ©s          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ llm_result:{id}         â†’ rÃ©sultats LLM (TTL 5min)      â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚               â”‚               â”‚                     â”‚
â”‚              â–¼               â–¼               â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Redis Helper v1  â”‚ â”‚ Health Check â”‚ â”‚ LLM Queue System â”‚       â”‚
â”‚  â”‚                  â”‚ â”‚ GLPI v1      â”‚ â”‚ (Gateway/Worker) â”‚       â”‚
â”‚  â”‚ POST /redis-     â”‚ â”‚              â”‚ â”‚                  â”‚       â”‚
â”‚  â”‚      helper      â”‚ â”‚ Cron 30s     â”‚ â”‚ Cron 1s (Worker) â”‚       â”‚
â”‚  â”‚                  â”‚ â”‚              â”‚ â”‚                  â”‚       â”‚
â”‚  â”‚ â€¢ GET            â”‚ â”‚ â€¢ Ping GLPI  â”‚ â”‚ â€¢ ZADD (Gateway) â”‚       â”‚
â”‚  â”‚ â€¢ SET (+TTL)     â”‚ â”‚ â€¢ Update     â”‚ â”‚ â€¢ ZPOPMAX        â”‚       â”‚
â”‚  â”‚ â€¢ DELETE         â”‚ â”‚   status     â”‚ â”‚ â€¢ Call Ollama    â”‚       â”‚
â”‚  â”‚ â€¢ SETNX (mutex)  â”‚ â”‚ â€¢ Alertes    â”‚ â”‚ â€¢ Callback       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ Workflow : WIDIP_Redis_Helper_v1

**Fichier** : `WIDIP_Redis_Helper_v1.json`  
**Endpoint** : `POST /webhook/redis-helper`  
**RÃ´le** : Proxy HTTP vers Redis pour les autres workflows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   WIDIP_Redis_Helper_v1                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  [Webhook] â”€â”€â–º [Parse Request] â”€â”€â–º [Switch Action]            â”‚
â”‚       POST /redis-helper               â”‚                       â”‚
â”‚                                        â”‚                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                    â”‚         â”‚         â”‚         â”‚         â”‚   â”‚
â”‚                    â–¼         â–¼         â–¼         â–¼         â”‚   â”‚
â”‚               [Redis    [Redis    [Redis    [Prepare       â”‚   â”‚
â”‚                GET]      SET]     DELETE]    SETNX]        â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚         â”‚         â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚     â”Œâ”€â”€â”€â”´â”€â”€â”€â”     â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚     â–¼       â–¼     â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚ [Check   [SET if  â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚  Exists]  empty]  â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚     â”‚       â”‚     â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚     â–¼       â–¼     â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚ [SETNX  [SETNX    â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚  Failed] Success] â”‚   â”‚
â”‚                    â”‚         â”‚         â”‚         â”‚         â”‚   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚                       â”‚
â”‚                                        â–¼                       â”‚
â”‚                              [Format Response]                 â”‚
â”‚                                        â”‚                       â”‚
â”‚                                        â–¼                       â”‚
â”‚                                  [Respond]                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Actions disponibles** :

| Action | Payload | Description |
|--------|---------|-------------|
| `get` | `{"action": "get", "key": "mykey"}` | Lire une clÃ© |
| `set` | `{"action": "set", "key": "k", "value": "v", "ttl": 300}` | Ã‰crire (TTL optionnel) |
| `delete` | `{"action": "delete", "key": "mykey"}` | Supprimer |
| `setnx` | `{"action": "setnx", "key": "lock", "value": "id", "ttl": 60}` | Set if Not eXists (mutex) |

---

## 4. Hub MCP Global

### ğŸ›ï¸ Architecture du Hub v6

**Fichier** : `WIDIP_MCP_SERVEUR_GLOBAL_v6.json`  
**RÃ´le** : Point d'entrÃ©e centralisÃ© pour toutes les communications MCP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WIDIP_MCP_SERVEUR_GLOBAL_v6                        â”‚
â”‚                      (Hub de Routage)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  MCP TRIGGERS  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  [1] MCP Server Observium     Path: /mcp-observium          â”‚  â”‚
â”‚  â”‚  [2] MCP Server Phibee        Path: /mcp-phibee             â”‚  â”‚
â”‚  â”‚  [3] MCP Server GLPI          Path: /mcp-glpi-server        â”‚  â”‚
â”‚  â”‚  [4] MCP Server SMTP          Path: /mcp-email              â”‚  â”‚
â”‚  â”‚  [5] MCP Server AD            Path: /mcp-ad           NEW   â”‚  â”‚
â”‚  â”‚  [6] MCP Server MySecret      Path: /mcp-mysecret     NEW   â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                   â”‚
â”‚                                â”‚ ai_tool connections               â”‚
â”‚                                â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  WORKFLOW TOOLS  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  [1] Call MCP Observium   â†’ WIDIP_MCP_Observium_v5          â”‚  â”‚
â”‚  â”‚  [2] Call MCP Phibee      â†’ WIDIP_MCP_Phibee_telecom_v5     â”‚  â”‚
â”‚  â”‚  [3] Call MCP GLPI        â†’ WIDIP_MCP_GLPI_v6               â”‚  â”‚
â”‚  â”‚  [4] Call MCP SMTP        â†’ WIDIP_MCP_SMTP_v5               â”‚  â”‚
â”‚  â”‚  [5] Call MCP AD          â†’ WIDIP_MCP_ActiveDirectory_v1    â”‚  â”‚
â”‚  â”‚  [6] Call MCP MySecret    â†’ WIDIP_MCP_MySecret_v1           â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”— Matrice de Routage MCP

| MCP Trigger | Path | Workflow Tool | Sub-Workflow ID |
|-------------|------|---------------|-----------------|
| Observium | `/mcp-observium` | Call MCP Observium | Ã€ configurer |
| Phibee | `/mcp-phibee` | Call MCP Phibee | fo2Ecbvioy4IKrh6 |
| GLPI | `/mcp-glpi-server` | Call MCP GLPI | aPU67DvaEk7Y5mFl |
| SMTP | `/mcp-email` | Call MCP SMTP | Lz6LZF9nIaRtNkMm |
| Active Directory | `/mcp-ad` | Call MCP AD | 4EzoFmFJvKGRbICU |
| MySecret | `/mcp-mysecret` | Call MCP MySecret | Ã€ configurer |

---

## 5. Workflow 1 : Proactif Observium v7

### ğŸ“– Vue d'Ensemble

**Fichier** : `WIDIP_Proactif_Observium_v7.json`  
**Trigger** : Webhook `/webhook/widip-alertes`  
**RÃ´le** : Traitement automatique des alertes rÃ©seau Observium

### ğŸ†• NouveautÃ©s v7

| FonctionnalitÃ© | Description |
|----------------|-------------|
| Check GLPI Health | VÃ©rifie Redis avant appel GLPI |
| Circuit Breaker | Mode dÃ©gradÃ© si GLPI down |
| Acquire/Release Lock Sentinel | Mutex LLM pour Agent Sentinel |
| Acquire/Release Lock Notificateur | Mutex LLM pour Agent Notificateur |
| Save to Redis Cache | Cache diagnostics Phibee (TTL 20min) |
| Merge Sentinel Output | Fusion cache hit + cache miss |

### ğŸ—ï¸ Architecture Proactif v7

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WIDIP_Proactif_Observium_v7                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PHASE 0: RÃ‰CEPTION & FILTRAGE                    â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [Webhook]     [Parse Alerte]     [RÃ©ponse        [Pre-Filter       â”‚  â”‚
â”‚  â”‚  Observium â”€â”€â–º + Tracking ID â”€â”€â”¬â”€â–º ImmÃ©diate] â—„â”€â”€ + Dedup]          â”‚  â”‚
â”‚  â”‚                                â”‚                        â”‚            â”‚  â”‚
â”‚  â”‚                                â”‚                        â–¼            â”‚  â”‚
â”‚  â”‚                                â”‚              [Alerte valide?]       â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚         â”‚       â”‚  â”‚
â”‚  â”‚                                â”‚                  YES        NO      â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚         â”‚       â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚    [Log FiltrÃ©e]â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                   â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PHASE 1: CACHE & CIRCUIT BREAKER        NEW v7   â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚                 â”‚  â”‚
â”‚  â”‚                                â”‚                   â–¼                 â”‚  â”‚
â”‚  â”‚                                â”‚        [Check Cache Redis]         â”‚  â”‚
â”‚  â”‚                                â”‚                   â”‚                 â”‚  â”‚
â”‚  â”‚                                â”‚                   â–¼                 â”‚  â”‚
â”‚  â”‚                                â”‚            [Cache Hit?]            â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚        â”‚           â”‚  â”‚
â”‚  â”‚                                â”‚              YES       NO          â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚        â”‚           â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚        â–¼           â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [Check GLPI       â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚   Health]          â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚        â”‚           â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚        â–¼           â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [IF GLPI OK?]     â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚       â”‚      â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚    YES      NO     â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚       â”‚      â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚  [Mode       â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚   DÃ©gradÃ©]   â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚               â”‚     â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PHASE 2: DIAGNOSTIC (MUTEX LLM)         NEW v7   â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â–¼              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [Acquire Lock     â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚   Sentinel]        â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â–¼              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚                Agent_Sentinel_v5_OptimisÃ©                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  LLM: Ollama Qwen 2.5 14B                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Tools: MCP Observium, MCP Phibee, MCP GLPI                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Timeout: 20s max                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Output: JSON diagnostic (responsabilitÃ©, sÃ©vÃ©ritÃ©)          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â–¼              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [Release Lock     â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚   Sentinel]        â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â–¼              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [Format           â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚   Diagnostic]      â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â–¼              â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚  [Save to Redis    â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚   Cache]  NEW v7   â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚               â”‚     â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PHASE 3: NOTIFICATION (MUTEX LLM)               â”‚  â”‚
â”‚  â”‚                                â”‚               â”‚     â”‚              â”‚  â”‚
â”‚  â”‚                                â”‚               â–¼     â–¼              â”‚  â”‚
â”‚  â”‚                                â”‚         [Merge Sentinel Output]   â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â”‚                                â”‚                    â–¼               â”‚  â”‚
â”‚  â”‚                                â”‚         [Acquire Lock Notificateur]â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚             Agent_Notificateur_v5_OptimisÃ©                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  LLM: Ollama Qwen 2.5 14B                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Tools: MCP GLPI (create_ticket), MCP SMTP (send_email)      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Timeout: 15s max                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Output: Actions effectuÃ©es (ticket_id, notifications)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â”‚                                â”‚                    â–¼               â”‚  â”‚
â”‚  â”‚                                â”‚         [Release Lock Notificateur]â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                    â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PHASE 4: VALIDATION & LOGGING                    â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â”‚                                â”‚                    â–¼               â”‚  â”‚
â”‚  â”‚                                â”‚           [Valider RÃ©ponse]        â”‚  â”‚
â”‚  â”‚                                â”‚                    â”‚               â”‚  â”‚
â”‚  â”‚                                â”‚                    â–¼               â”‚  â”‚
â”‚  â”‚                                â”‚           [Workflow RÃ©ussi?]       â”‚  â”‚
â”‚  â”‚                                â”‚                â”‚         â”‚         â”‚  â”‚
â”‚  â”‚                                â”‚               YES        NO        â”‚  â”‚
â”‚  â”‚                                â”‚                â”‚         â”‚         â”‚  â”‚
â”‚  â”‚                                â”‚                â–¼         â–¼         â”‚  â”‚
â”‚  â”‚                                â”‚          [Log DB]   [Notif        â”‚  â”‚
â”‚  â”‚                                â”‚          [Export     Erreur]      â”‚  â”‚
â”‚  â”‚                                â”‚           Prometheus]             â”‚  â”‚
â”‚  â”‚                                â”‚                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ DÃ©tail des Nodes v7 AjoutÃ©s

| Node | Type | Fonction |
|------|------|----------|
| Check Cache Redis | Code | Appelle Redis Helper GET pour cache Phibee |
| Cache Hit? | IF | Branch selon prÃ©sence cache |
| Check GLPI Health | Code | Lit `glpi_health_status` dans Redis |
| IF GLPI OK? | IF | Branch mode normal / dÃ©gradÃ© |
| Mode DÃ©gradÃ© | Code | Flag le contexte comme dÃ©gradÃ© |
| Acquire Lock Sentinel | Code | SETNX `llm_mutex` avec polling |
| Release Lock Sentinel | Code | DELETE `llm_mutex` |
| Save to Redis Cache | Code | SET diagnostic avec TTL 20min |
| Merge Sentinel Output | Merge | Fusionne branches cache hit/miss |
| Acquire Lock Notificateur | Code | SETNX `llm_mutex` avec polling |
| Release Lock Notificateur | Code | DELETE `llm_mutex` |

---

## 6. Workflow 2 : Assist Ticket v3

### ğŸ“– Vue d'Ensemble

**Fichier** : `WIDIP_Assist_ticket_v3.json`  
**Trigger** : Schedule (toutes les 3 minutes)  
**RÃ´le** : Traitement automatique des tickets GLPI (reset MDP, dÃ©blocage compte)

### ğŸ†• NouveautÃ©s v3

| FonctionnalitÃ© | Description |
|----------------|-------------|
| Check GLPI Health | VÃ©rifie Redis avant traitement |
| Circuit Breaker | Skip cycle si GLPI down |
| Acquire/Release LLM Lock | Mutex pour Ã©viter collision GPU |
| Skip Cycle | Mode dÃ©gradÃ© avec log |

### ğŸ—ï¸ Architecture Assist v3

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WIDIP_Assist_ticket_v3                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  [Polling 3min] â”€â”€â–º [Initialiser Contexte]                                â”‚
â”‚                              â”‚                                             â”‚
â”‚                              â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 PHASE 1: CIRCUIT BREAKER                  NEW v3  â”‚    â”‚
â”‚  â”‚                              â”‚                                     â”‚    â”‚
â”‚  â”‚                              â–¼                                     â”‚    â”‚
â”‚  â”‚                   [Check GLPI Health]                              â”‚    â”‚
â”‚  â”‚                              â”‚                                     â”‚    â”‚
â”‚  â”‚                              â–¼                                     â”‚    â”‚
â”‚  â”‚                      [IF GLPI OK?]                                 â”‚    â”‚
â”‚  â”‚                         â”‚       â”‚                                  â”‚    â”‚
â”‚  â”‚                        YES      NO                                 â”‚    â”‚
â”‚  â”‚                         â”‚       â”‚                                  â”‚    â”‚
â”‚  â”‚                         â”‚       â–¼                                  â”‚    â”‚
â”‚  â”‚                         â”‚  [Skip Cycle - GLPI Down] â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           PHASE 2: MUTEX LLM                         NEW v3  â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚                         â–¼                                    â”‚     â”‚    â”‚
â”‚  â”‚              [Acquire LLM Lock]                              â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚ (polling 500ms, timeout 90s)       â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           PHASE 3: AGENT SUPPORT                             â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚              Agent Support WIDIP                       â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  LLM: Ollama Qwen 2.5 14B                              â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  Tools:                                                 â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ MCP GLPI (search_tickets, add_followup, close)     â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ MCP Active Directory (check_user, reset_password)  â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ MCP MySecret (create_secret)                       â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ MCP SMTP (send_email)                              â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  Max Iterations: 15                                     â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  CatÃ©gories gÃ©rÃ©es:                                    â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ RESET_MDP â†’ Reset complet + email sÃ©curisÃ©         â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ DEBLOCAGE_COMPTE â†’ Unlock AD + close ticket        â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ CREATION_COMPTE â†’ Followup privÃ© (escalade)        â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   â€¢ AUTRE â†’ Escalade manuelle                          â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                            â”‚                                    â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           PHASE 4: RELEASE & PARSING                 NEW v3  â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚                         â–¼                                    â”‚     â”‚    â”‚
â”‚  â”‚              [Release LLM Lock]                              â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚                         â–¼                                    â”‚     â”‚    â”‚
â”‚  â”‚               [Parser RÃ©sultats]                             â”‚     â”‚    â”‚
â”‚  â”‚                         â”‚                                    â”‚     â”‚    â”‚
â”‚  â”‚                         â–¼                                    â”‚     â”‚    â”‚
â”‚  â”‚              [Tickets traitÃ©s?]                              â”‚     â”‚    â”‚
â”‚  â”‚                    â”‚         â”‚                               â”‚     â”‚    â”‚
â”‚  â”‚                   YES        NO                              â”‚     â”‚    â”‚
â”‚  â”‚                    â”‚         â”‚                               â”‚     â”‚    â”‚
â”‚  â”‚                    â–¼         â–¼                               â”‚     â”‚    â”‚
â”‚  â”‚           [PrÃ©parer     [Log                                â”‚     â”‚    â”‚
â”‚  â”‚            Notification] InactivitÃ©]                        â”‚     â”‚    â”‚
â”‚  â”‚                    â”‚         â”‚                               â”‚     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚         â”‚                               â”‚          â”‚
â”‚                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                               â”‚          â”‚
â”‚                            â”‚                                    â”‚          â”‚
â”‚                            â–¼                                    â”‚          â”‚
â”‚                [Merge Tous les Flux] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚                    [Log PostgreSQL]                                        â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ CatÃ©gories de Tickets GÃ©rÃ©es

| CatÃ©gorie | Mots-clÃ©s | Workflow Automatique |
|-----------|-----------|----------------------|
| RESET_MDP | mot de passe, oubliÃ©, reset | check_user â†’ reset_password â†’ create_secret â†’ send_email â†’ close_ticket |
| DEBLOCAGE | bloquÃ©, verrouillÃ©, locked | check_user â†’ unlock_account â†’ close_ticket |
| CREATION | nouveau compte, arrivÃ©e | add_followup (privÃ©) â†’ escalade manuelle |
| AUTRE | - | add_followup â†’ escalade |

---

## 7. Workflow 3 : WIBOT (Assistant IA)

### ğŸ“– Vue d'Ensemble

**Fichier** : `WIBOT_v1.json`  
**Trigger** : Chat Trigger (Web UI)  
**RÃ´le** : Assistant conversationnel pour employÃ©s WIDIP avec contrÃ´le d'accÃ¨s

### ğŸ—ï¸ Architecture WIBOT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WIBOT_v1                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  [Chat Trigger] â”€â”€â–º [Extract User Context]                                â”‚
â”‚       â”‚                       â”‚                                            â”‚
â”‚       â”‚                       â–¼                                            â”‚
â”‚       â”‚              [Read Access Matrix CSV]                              â”‚
â”‚       â”‚                       â”‚                                            â”‚
â”‚       â”‚                       â–¼                                            â”‚
â”‚       â”‚              [Merge User + Matrix]                                 â”‚
â”‚       â”‚                       â”‚                                            â”‚
â”‚       â”‚                       â–¼                                            â”‚
â”‚       â”‚              [Check Authorization]                                 â”‚
â”‚       â”‚                       â”‚                                            â”‚
â”‚       â”‚                       â–¼                                            â”‚
â”‚       â”‚                [IF Authorized?]                                    â”‚
â”‚       â”‚                   â”‚        â”‚                                       â”‚
â”‚       â”‚                  YES       NO â”€â”€â–º [Unauthorized Response]          â”‚
â”‚       â”‚                   â”‚                                                â”‚
â”‚       â”‚                   â–¼                                                â”‚
â”‚       â”‚       [Format Dynamic System Prompt]                               â”‚
â”‚       â”‚                   â”‚                                                â”‚
â”‚       â”‚                   â”‚  Permissions injectÃ©es:                        â”‚
â”‚       â”‚                   â”‚  â€¢ acces_glpi                                  â”‚
â”‚       â”‚                   â”‚  â€¢ acces_base_docs                             â”‚
â”‚       â”‚                   â”‚  â€¢ acces_contrats                              â”‚
â”‚       â”‚                   â”‚  â€¢ clients_autorises                           â”‚
â”‚       â”‚                   â”‚                                                â”‚
â”‚       â”‚                   â–¼                                                â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚       â”‚  â”‚                    Agent WIBOT                              â”‚  â”‚
â”‚       â”‚  â”‚                                                              â”‚  â”‚
â”‚       â”‚  â”‚  LLM: Claude Sonnet 4 (Anthropic API)                       â”‚  â”‚
â”‚       â”‚  â”‚  Tools: MCP GLPI (si autorisÃ©)                              â”‚  â”‚
â”‚       â”‚  â”‚  RAG: Vector Store (si acces_base_docs)                     â”‚  â”‚
â”‚       â”‚  â”‚  Memory: Conversation Buffer                                â”‚  â”‚
â”‚       â”‚  â”‚                                                              â”‚  â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                   â”‚                                                â”‚
â”‚       â”‚                   â–¼                                                â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Response to Chat]                                    â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ” Matrice d'AccÃ¨s CSV

| Colonne | Type | Description |
|---------|------|-------------|
| user_id | string | Identifiant utilisateur |
| acces_glpi | boolean | AccÃ¨s aux outils GLPI |
| acces_base_docs | boolean | AccÃ¨s RAG documentaire |
| acces_contrats | boolean | AccÃ¨s infos contrats |
| acces_confidential | boolean | AccÃ¨s donnÃ©es sensibles |
| clients_autorises | array | Liste clients autorisÃ©s |
| categories_tickets | array | Types tickets accessibles |

---

## 8. Workflows Infrastructure

### ğŸ“ Liste des Workflows Infrastructure

| Workflow | Fichier | Trigger | RÃ´le |
|----------|---------|---------|------|
| Redis Helper | `WIDIP_Redis_Helper_v1.json` | Webhook | Proxy HTTP â†’ Redis |
| Health Check GLPI | `WIDIP_Health_Check_GLPI_v1.json` | Cron 30s | Circuit Breaker |
| LLM Gateway | `WIDIP_LLM_Gateway_v1.json` | Webhook | Queue prioritÃ©s (optionnel) |
| LLM Worker | `WIDIP_LLM_Worker_v1.json` | Cron 1s | Consommateur queue (optionnel) |
| LLM Result | `WIDIP_LLM_Result_v1.json` | Webhook | RÃ©cupÃ©ration rÃ©sultats (optionnel) |

### ğŸ“ Workflow : WIDIP_Health_Check_GLPI_v1

**Fichier** : `WIDIP_Health_Check_GLPI_v1.json`  
**Trigger** : Schedule (toutes les 30 secondes)  
**RÃ´le** : Monitoring santÃ© GLPI + Circuit Breaker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WIDIP_Health_Check_GLPI_v1                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  [Check Every 30s] â”€â”€â–º [Ping GLPI API]                                    â”‚
â”‚                              â”‚                                             â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                       â”‚ Success     â”‚ Error                                â”‚
â”‚                       â–¼             â–¼                                      â”‚
â”‚              [Analyze Health Response]                                     â”‚
â”‚                       â”‚                                                    â”‚
â”‚                       â”‚ status: ok | degraded | down                       â”‚
â”‚                       â”‚                                                    â”‚
â”‚                       â–¼                                                    â”‚
â”‚              [Update Redis Status]                                         â”‚
â”‚                       â”‚                                                    â”‚
â”‚                       â”‚ SET glpi_health_status {status} TTL 60             â”‚
â”‚                       â”‚                                                    â”‚
â”‚                       â–¼                                                    â”‚
â”‚                [GLPI Down?]                                                â”‚
â”‚                   â”‚       â”‚                                                â”‚
â”‚                  YES      NO                                               â”‚
â”‚                   â”‚       â”‚                                                â”‚
â”‚                   â–¼       â–¼                                                â”‚
â”‚           [Check Alert   [GLPI OK                                          â”‚
â”‚            Already Sent]  Handler]                                         â”‚
â”‚                   â”‚       â”‚                                                â”‚
â”‚                   â–¼       â–¼                                                â”‚
â”‚           [Should Send   [Check Was                                        â”‚
â”‚            Alert?]        Down]                                            â”‚
â”‚              â”‚    â”‚           â”‚                                            â”‚
â”‚             YES   NO          â”‚                                            â”‚
â”‚              â”‚    â”‚           â–¼                                            â”‚
â”‚              â–¼    â”‚    [Was Previously                                     â”‚
â”‚           [Prepareâ”‚     Down?]                                             â”‚
â”‚            Down   â”‚      â”‚       â”‚                                         â”‚
â”‚            Alert] â”‚     YES      NO                                        â”‚
â”‚              â”‚    â”‚      â”‚       â”‚                                         â”‚
â”‚              â–¼    â”‚      â–¼       â”‚                                         â”‚
â”‚           [Mark   â”‚   [Prepare   â”‚                                         â”‚
â”‚            Alert  â”‚    Recovery  â”‚                                         â”‚
â”‚            Sent]  â”‚    Alert]    â”‚                                         â”‚
â”‚              â”‚    â”‚      â”‚       â”‚                                         â”‚
â”‚              â”‚    â”‚      â–¼       â”‚                                         â”‚
â”‚              â”‚    â”‚   [Clear     â”‚                                         â”‚
â”‚              â”‚    â”‚    Down      â”‚                                         â”‚
â”‚              â”‚    â”‚    Flag]     â”‚                                         â”‚
â”‚              â”‚    â”‚      â”‚       â”‚                                         â”‚
â”‚              â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                       â”‚                                                    â”‚
â”‚                       â–¼                                                    â”‚
â”‚               [Log Health Check]                                           â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ClÃ©s Redis gÃ©rÃ©es** :

| ClÃ© | Valeurs | TTL | Usage |
|-----|---------|-----|-------|
| `glpi_health_status` | ok, degraded, down | 60s | Lu par Proactif/Assist |
| `glpi_down_alert_sent` | sent | 300s | Anti-spam alertes |

---

## 9. Services MCP (Sub-workflows)

### ğŸ“ Liste des Services MCP

| Service | Fichier | OpÃ©rations |
|---------|---------|------------|
| GLPI | `WIDIP_MCP_GLPI_v6.json` | 8 opÃ©rations |
| Observium | `WIDIP_MCP_Observium_v5.json` | 4 opÃ©rations |
| Phibee | `WIDIP_MCP_Phibee_telecom_v5.json` | 3 opÃ©rations |
| SMTP | `WIDIP_MCP_SMTP_v5.json` | 2 opÃ©rations |
| Active Directory | `WIDIP_MCP_ActiveDirectory_v1.json` | 4 opÃ©rations |
| MySecret | `WIDIP_MCP_MySecret_v1.json` | 1 opÃ©ration |

### ğŸ”§ DÃ©tail : MCP_GLPI_v6

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      WIDIP_MCP_GLPI_v6                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  [Execute Workflow Trigger]                                    â”‚
â”‚           â”‚                                                    â”‚
â”‚           â–¼                                                    â”‚
â”‚      [Switch Operation]                                        â”‚
â”‚           â”‚                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”        â”‚
â”‚     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼     â–¼        â”‚
â”‚  search  get    add   close search get   assign update        â”‚
â”‚  _new    _ticket follow ticket _client _user _ticket _ticket  â”‚
â”‚  _tickets _details _up                                        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| OpÃ©ration | ParamÃ¨tres | Description |
|-----------|------------|-------------|
| search_new_tickets | minutes_since, limit | Tickets rÃ©cents non traitÃ©s |
| get_ticket_details | ticket_id | DÃ©tails complets ticket |
| add_ticket_followup | ticket_id, content, is_private | Ajouter suivi |
| close_ticket | ticket_id, solution | ClÃ´turer ticket |
| search_client | name, email, phone | Rechercher utilisateur |
| get_user | user_id | Infos utilisateur |
| assign_ticket | ticket_id, user_id | Assigner ticket |
| update_ticket | ticket_id, fields | Modifier ticket |

### ğŸ”§ DÃ©tail : MCP_ActiveDirectory_v1

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  WIDIP_MCP_ActiveDirectory_v1                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  [Execute Workflow Trigger]                                    â”‚
â”‚           â”‚                                                    â”‚
â”‚           â–¼                                                    â”‚
â”‚      [Route Operation]                                         â”‚
â”‚           â”‚                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚     â–¼     â–¼     â–¼             â–¼             â–¼                 â”‚
â”‚  check  reset  get_user     unlock      fallback              â”‚
â”‚  _user  _pwd   _info        _account                          â”‚
â”‚     â”‚     â”‚       â”‚             â”‚                              â”‚
â”‚     â–¼     â–¼       â–¼             â–¼                              â”‚
â”‚  [SSH   [Generate [SSH        [SSH                             â”‚
â”‚   Check] Password] Get Info]   Unlock]                         â”‚
â”‚     â”‚     â”‚       â”‚             â”‚                              â”‚
â”‚     â”‚     â–¼       â”‚             â”‚                              â”‚
â”‚     â”‚  [SSH       â”‚             â”‚                              â”‚
â”‚     â”‚   Reset]    â”‚             â”‚                              â”‚
â”‚     â”‚     â”‚       â”‚             â”‚                              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚           â”‚                                                    â”‚
â”‚           â–¼                                                    â”‚
â”‚      [Parse Response]                                          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| OpÃ©ration | ParamÃ¨tres | Description |
|-----------|------------|-------------|
| check_user | username | VÃ©rifie existence + statut |
| reset_password | username | Reset + gÃ©nÃ¨re nouveau MDP |
| get_user_info | username | Infos complÃ¨tes (email, dept) |
| unlock_account | username | DÃ©bloquer compte verrouillÃ© |

### ğŸ”§ DÃ©tail : MCP_MySecret_v1

| OpÃ©ration | ParamÃ¨tres | Description |
|-----------|------------|-------------|
| create_secret | payload, expire_days, expire_views | CrÃ©e lien sÃ©curisÃ© |

**Output** : `{ secret_url: "https://mysecret.widip.fr/p/xxx", expires_in_days: 7 }`

---

## 10. SystÃ¨me de Queue LLM

### ğŸ“– Vue d'Ensemble

Le systÃ¨me de queue LLM est **optionnel** - le Mutex simple suffit pour le volume actuel. Il devient utile en cas de charge Ã©levÃ©e avec besoin de prioritÃ©s strictes.

### ğŸ—ï¸ Architecture Queue LLM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SYSTÃˆME DE QUEUE LLM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  Workflows mÃ©tier                                                          â”‚
â”‚       â”‚                                                                    â”‚
â”‚       â”‚ POST /webhook/llm-gateway                                          â”‚
â”‚       â”‚ {"source": "proactif_sentinel", "prompt": "..."}                   â”‚
â”‚       â”‚                                                                    â”‚
â”‚       â–¼                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    WIDIP_LLM_Gateway_v1                             â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [Webhook] â”€â”€â–º [Generate Request ID + Priority]                     â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â”‚ Score = (priority Ã— 100000) + timestamp   â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â”‚ PrioritÃ©s:                                 â”‚  â”‚
â”‚  â”‚                         â”‚  â€¢ proactif_sentinel: 1000                â”‚  â”‚
â”‚  â”‚                         â”‚  â€¢ proactif_notificateur: 900             â”‚  â”‚
â”‚  â”‚                         â”‚  â€¢ assist: 500                             â”‚  â”‚
â”‚  â”‚                         â”‚  â€¢ wibot: 100                              â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚                 [Redis ZADD llm_queue]                               â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚              [Respond 202 Accepted]                                  â”‚  â”‚
â”‚  â”‚                  {request_id, position, estimated_wait}              â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    WIDIP_LLM_Worker_v1                              â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [Poll Queue 1s] â”€â”€â–º [Redis ZPOPMAX llm_queue]                      â”‚  â”‚
â”‚  â”‚                              â”‚                                       â”‚  â”‚
â”‚  â”‚                              â”‚ Prend requÃªte avec plus haut score   â”‚  â”‚
â”‚  â”‚                              â”‚                                       â”‚  â”‚
â”‚  â”‚                              â–¼                                       â”‚  â”‚
â”‚  â”‚                    [Queue Not Empty?]                                â”‚  â”‚
â”‚  â”‚                         â”‚       â”‚                                    â”‚  â”‚
â”‚  â”‚                        YES      NO â”€â”€â–º (attendre)                    â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚                  [Parse Payload]                                     â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚                  [Call Ollama API]                                   â”‚  â”‚
â”‚  â”‚                   (timeout 120s)                                     â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                     â”‚  â”‚
â”‚  â”‚               Success       Error                                    â”‚  â”‚
â”‚  â”‚                  â”‚             â”‚                                     â”‚  â”‚
â”‚  â”‚                  â–¼             â–¼                                     â”‚  â”‚
â”‚  â”‚           [Prepare      [Prepare                                     â”‚  â”‚
â”‚  â”‚            Result]       Error]                                      â”‚  â”‚
â”‚  â”‚                  â”‚             â”‚                                     â”‚  â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                     â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚              [Redis SET llm_result:{id}]                             â”‚  â”‚
â”‚  â”‚                    (TTL 5min)                                        â”‚  â”‚
â”‚  â”‚                         â”‚                                            â”‚  â”‚
â”‚  â”‚                         â–¼                                            â”‚  â”‚
â”‚  â”‚              [Has Callback URL?]                                     â”‚  â”‚
â”‚  â”‚                    â”‚       â”‚                                         â”‚  â”‚
â”‚  â”‚                   YES      NO                                        â”‚  â”‚
â”‚  â”‚                    â”‚       â”‚                                         â”‚  â”‚
â”‚  â”‚                    â–¼       â”‚                                         â”‚  â”‚
â”‚  â”‚              [Send         â”‚                                         â”‚  â”‚
â”‚  â”‚               Callback]    â”‚                                         â”‚  â”‚
â”‚  â”‚                    â”‚       â”‚                                         â”‚  â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    WIDIP_LLM_Result_v1                              â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [GET /llm-result/:id] â”€â”€â–º [Redis GET llm_result:{id}]              â”‚  â”‚
â”‚  â”‚                                    â”‚                                 â”‚  â”‚
â”‚  â”‚                             [Result Exists?]                         â”‚  â”‚
â”‚  â”‚                                â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚                               YES      NO                            â”‚  â”‚
â”‚  â”‚                                â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚                                â–¼       â–¼                             â”‚  â”‚
â”‚  â”‚                          [200 OK]  [202 Pending]                     â”‚  â”‚
â”‚  â”‚                          {result}  "Retry in 1-2s"                   â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Matrice des DÃ©pendances

### ğŸ”— DÃ©pendances Workflows â†’ Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Workflow      â”‚ GLPI â”‚ Obs. â”‚ Phibee â”‚ SMTP â”‚  AD  â”‚MySecretâ”‚ Redis â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Proactif_v7       â”‚  âœ…  â”‚  âœ…  â”‚   âœ…   â”‚  âœ…  â”‚  âŒ  â”‚   âŒ   â”‚  âœ…   â”‚
â”‚ Assist_v3         â”‚  âœ…  â”‚  âŒ  â”‚   âŒ   â”‚  âœ…  â”‚  âœ…  â”‚   âœ…   â”‚  âœ…   â”‚
â”‚ WIBOT_v1          â”‚  âœ…  â”‚  âŒ  â”‚   âŒ   â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âŒ   â”‚
â”‚ Health_Check_GLPI â”‚  âœ…  â”‚  âŒ  â”‚   âŒ   â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âœ…   â”‚
â”‚ LLM_Gateway       â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âœ…   â”‚
â”‚ LLM_Worker        â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âŒ  â”‚  âŒ  â”‚   âŒ   â”‚  âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”— DÃ©pendances Workflows â†’ LLMs

| Workflow | LLM | Provider | Context Window |
|----------|-----|----------|----------------|
| Proactif_v7 (Sentinel) | Qwen 2.5 14B | Ollama | 16384 |
| Proactif_v7 (Notificateur) | Qwen 2.5 14B | Ollama | 16384 |
| Assist_v3 | Qwen 2.5 14B | Ollama | 16384 |
| WIBOT_v1 | Claude Sonnet 4 | Anthropic API | Variable |
| LLM_Worker | Qwen 2.5 14B | Ollama | 16384 |

---

## 12. MÃ©triques & ObservabilitÃ©

### ğŸ“Š MÃ©triques CollectÃ©es

| Source | MÃ©triques | Destination |
|--------|-----------|-------------|
| Proactif_v7 | workflow_duration_ms, sentinel_duration_ms, cache_hit | Prometheus |
| Assist_v3 | tickets_found, tickets_processed, duration_seconds | PostgreSQL |
| Health_Check | glpi_status, latency_ms | Redis + Logs |
| LLM_Worker | processing_time_ms, queue_length | Redis |

### ğŸ“ˆ Export Prometheus (Proactif)

```
# MÃ©triques exportÃ©es vers Pushgateway
widip_workflow_duration_seconds{workflow="proactif", version="v7"}
widip_sentinel_duration_seconds{tracking_id="ALT-xxx"}
widip_cache_hit_total{workflow="proactif"}
widip_workflow_success_total{workflow="proactif"}
widip_workflow_error_total{workflow="proactif"}
```

### ğŸ—„ï¸ Tables PostgreSQL

**Table: incident_logs (Proactif)**
```sql
CREATE TABLE incident_logs (
  id SERIAL PRIMARY KEY,
  tracking_id VARCHAR(50) UNIQUE NOT NULL,
  device_name VARCHAR(255),
  ip_address VARCHAR(45),
  responsibility VARCHAR(50),
  severity VARCHAR(20),
  ticket_id VARCHAR(50),
  workflow_duration_ms INTEGER,
  cache_used BOOLEAN,
  created_at TIMESTAMP DEFAULT NOW()
);
```

**Table: widip_agent_logs (Assist)**
```sql
CREATE TABLE widip_agent_logs (
  id SERIAL PRIMARY KEY,
  execution_id VARCHAR(100),
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  status VARCHAR(20),
  tickets_found INTEGER,
  tickets_processed JSONB,
  actions_detected TEXT,
  duration_seconds INTEGER,
  errors JSONB
);
```

---

## 13. Guide de DÃ©ploiement

### ğŸš€ Ordre de DÃ©ploiement

```
Ã‰TAPE 1: Infrastructure
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1.1 DÃ©ployer Redis
      docker run -d --name widip-redis -p 6379:6379 redis:7.2-alpine
  
  1.2 CrÃ©er credential Redis dans n8n
      Host: localhost (ou widip-redis si Docker network)
      Port: 6379

Ã‰TAPE 2: Workflows Infrastructure
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  2.1 Importer WIDIP_Redis_Helper_v1.json
  2.2 Configurer credentials Redis dans le workflow
  2.3 Activer le workflow
  2.4 Tester: curl -X POST http://localhost:5678/webhook/redis-helper \
              -H "Content-Type: application/json" \
              -d '{"action":"set","key":"test","value":"ok","ttl":60}'

  2.5 Importer WIDIP_Health_Check_GLPI_v1.json
  2.6 Configurer GLPI_API_URL et credentials
  2.7 Activer le workflow

Ã‰TAPE 3: Hub MCP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  3.1 Importer WIDIP_MCP_SERVEUR_GLOBAL_v6.json
  3.2 Configurer les workflow IDs des sub-workflows
  3.3 Activer le workflow

Ã‰TAPE 4: Sub-workflows MCP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  4.1 Importer les 6 sub-workflows MCP
  4.2 Configurer credentials pour chaque API externe
  4.3 Activer les workflows

Ã‰TAPE 5: Workflows MÃ©tier
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  5.1 Importer WIDIP_Proactif_Observium_v7.json
  5.2 Configurer MCP Client endpoints
  5.3 Activer le workflow

  5.4 Importer WIDIP_Assist_ticket_v3.json
  5.5 Configurer MCP Client endpoints
  5.6 Configurer PostgreSQL credentials
  5.7 Activer le workflow

  5.8 Importer WIBOT_v1.json (si utilisÃ©)
  5.9 Configurer matrice d'accÃ¨s CSV
  5.10 Activer le workflow

Ã‰TAPE 6: Workflows Queue LLM (Optionnel)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  6.1 Importer WIDIP_LLM_Gateway_v1.json
  6.2 Importer WIDIP_LLM_Worker_v1.json
  6.3 Importer WIDIP_LLM_Result_v1.json
  6.4 Configurer credentials Redis
  6.5 Activer les workflows
```

### âœ… Checklist de VÃ©rification

```
Infrastructure
  [ ] Redis accessible sur port 6379
  [ ] Redis Helper rÃ©pond sur /webhook/redis-helper
  [ ] Health Check GLPI actif (vÃ©rifier logs)

Hub MCP
  [ ] Hub MCP activÃ©
  [ ] Tous les sub-workflows MCP actifs

Workflows MÃ©tier
  [ ] Proactif_v7 : Test webhook /webhook/widip-alertes
  [ ] Assist_v3 : VÃ©rifier polling 3min dans logs
  [ ] WIBOT_v1 : Test chat (si utilisÃ©)

Monitoring
  [ ] ClÃ© glpi_health_status prÃ©sente dans Redis
  [ ] Logs PostgreSQL crÃ©Ã©s aprÃ¨s exÃ©cutions
  [ ] (Optionnel) Prometheus reÃ§oit mÃ©triques
```

### ğŸ“‹ Variables d'Environnement

```bash
# n8n
N8N_HOST=localhost
N8N_PORT=5678

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# GLPI
GLPI_API_URL=http://localhost:8670
GLPI_APP_TOKEN=xxx

# Ollama
OLLAMA_HOST=http://localhost:11434

# PostgreSQL
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=widip_logs
POSTGRES_USER=widip
POSTGRES_PASSWORD=xxx

# Active Directory (SSH)
WINDOWS_SSH_HOST=xxx
WINDOWS_SSH_USER=xxx
WINDOWS_SSH_PASSWORD=xxx

# MySecret
MYSECRET_API_URL=https://mysecret.widip.fr

# Prometheus (optionnel)
PROMETHEUS_PUSHGATEWAY=http://localhost:9091
```

---

## ğŸ“„ Annexes

### A. Liste ComplÃ¨te des Fichiers

| CatÃ©gorie | Fichier | Version |
|-----------|---------|---------|
| **Infrastructure** | WIDIP_Redis_Helper_v1.json | v1 |
| | WIDIP_Health_Check_GLPI_v1.json | v1 |
| | WIDIP_LLM_Gateway_v1.json | v1 |
| | WIDIP_LLM_Worker_v1.json | v1 |
| | WIDIP_LLM_Result_v1.json | v1 |
| **Hub MCP** | WIDIP_MCP_SERVEUR_GLOBAL_v6.json | v6 |
| **Services MCP** | WIDIP_MCP_GLPI_v6.json | v6 |
| | WIDIP_MCP_Observium_v5.json | v5 |
| | WIDIP_MCP_Phibee_telecom_v5.json | v5 |
| | WIDIP_MCP_SMTP_v5.json | v5 |
| | WIDIP_MCP_ActiveDirectory_v1.json | v1 |
| | WIDIP_MCP_MySecret_v1.json | v1 |
| **Workflows MÃ©tier** | WIDIP_Proactif_Observium_v7.json | v7 |
| | WIDIP_Assist_ticket_v3.json | v3 |
| | WIBOT_v1.json | v1 |

### B. Changelog v1 â†’ v2

| Version | Date | Changements |
|---------|------|-------------|
| v1.0 | Nov 2024 | Architecture initiale |
| v2.0 | Dec 2024 | + Redis infrastructure |
| | | + Circuit Breaker (Health Check GLPI) |
| | | + Mutex LLM (Acquire/Release Lock) |
| | | + Cache diagnostics Phibee |
| | | + Queue LLM avec prioritÃ©s |
| | | + MCP Active Directory |
| | | + MCP MySecret |
| | | Proactif v6 â†’ v7 |
| | | Assist v2 â†’ v3 |

---

**Fin du document**

*Documentation gÃ©nÃ©rÃ©e le 01 DÃ©cembre 2024*  
*WIDIP - Infrastructure IA Locale*  
*Licence Apache 2.0*
