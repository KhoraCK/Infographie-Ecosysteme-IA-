# ğŸ—ï¸ Architecture WIDIP v7 - Automatisation IA des OpÃ©rations IT

> **Version** : 7.0  
> **Date** : 12 DÃ©cembre 2025  
> **Auteur** : RIPOUTEAU Maxime  
> **Statut** : Production Ready - MÃ©moire RAG Active intÃ©grÃ©e

---

## ğŸ“‹ Table des matiÃ¨res

1. [Contexte et vision](#1-contexte-et-vision)
2. [NouveautÃ©s v7 : MÃ©moire RAG Active](#2-nouveautÃ©s-v7--mÃ©moire-rag-active)
3. [Infrastructure bi-VM](#3-infrastructure-bi-vm)
4. [Vue d'ensemble de l'architecture](#4-vue-densemble-de-larchitecture)
5. [Les workflows principaux](#5-les-workflows-principaux)
6. [SystÃ¨me MCP : les outils des agents](#6-systÃ¨me-mcp--les-outils-des-agents)
7. [Redis : mÃ©moire partagÃ©e et synchronisation](#7-redis--mÃ©moire-partagÃ©e-et-synchronisation)
8. [Dashboard Backend API](#8-dashboard-backend-api)
9. [Exemple complet de bout en bout](#9-exemple-complet-de-bout-en-bout)
10. [Credentials et sÃ©curitÃ©](#10-credentials-et-sÃ©curitÃ©)
11. [DÃ©ploiement](#11-dÃ©ploiement)
12. [Changelog v6 â†’ v7](#12-changelog-v6--v7)

---

## 1. Contexte et vision

### 1.1 Qui est WIDIP ?

**WIDIP** est une entreprise d'hÃ©bergement de donnÃ©es spÃ©cialisÃ©e dans le secteur **mÃ©dico-social**. Elle accompagne plus de **800 Ã©tablissements** (EHPAD, cliniques, associations, structures d'accueil) dans la gestion de leur infrastructure IT.

### 1.2 Le dÃ©fi opÃ©rationnel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VOLUME ANNUEL WIDIP                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š ~20 000 tickets de support / an                             â”‚
â”‚  ğŸ¥ 800+ Ã©tablissements clients                                 â”‚
â”‚  ğŸŒ Infrastructure rÃ©seau distribuÃ©e                            â”‚
â”‚  â° Support 24/7 requis pour le secteur santÃ©                   â”‚
â”‚  ğŸ” Diagnostic rÃ©seau complexe (WIDIP / FAI / Local)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 La solution v7 : IA avec mÃ©moire long-terme

| CapacitÃ© | Description |
|----------|-------------|
| ğŸ§  **Apprendre** | Chaque ticket clos devient une connaissance vectorisÃ©e |
| ğŸ” **Se souvenir** | Consulte l'historique avant d'agir (RAG) |
| ğŸ“¡ **Diagnostiquer** | Analyser automatiquement les alertes rÃ©seau via Observium |
| ğŸ« **CrÃ©er des tickets** | Ouvrir des tickets GLPI enrichis avec diagnostic |
| ğŸ“§ **Notifier + Demander** | Envoyer emails + demande d'outil diagnostic si nÃ©cessaire |
| ğŸ› ï¸ **Collecter** | Recevoir les codes DIAG du client via l'outil |
| ğŸ§® **Analyser** | DÃ©terminer automatiquement la responsabilitÃ© (WIDIP/FAI/Local) |
| ğŸ”§ **Agir** | RÃ©initialiser mots de passe, dÃ©bloquer/crÃ©er comptes |

---

## 2. NouveautÃ©s v7 : MÃ©moire RAG Active

### 2.1 La fonctionnalitÃ© phare

> **"WIDIP ne rÃ©agit plus seulement au prÃ©sent. Il apprend du passÃ©."**

En v6, WIDIP Ã©tait rÃ©actif : il traitait chaque incident comme un cas isolÃ©. En v7, WIDIP devient **proactif et expÃ©rimentÃ©** grÃ¢ce Ã  la **MÃ©moire RAG Active** :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MÃ‰MOIRE RAG ACTIVE - Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   PHASE 1: APPRENTISSAGE (RAG Ingestor - Manuel/Cron)                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ GLPI DB     â”‚â”€â”€â”€â”€â–ºâ”‚ Format + Clean  â”‚â”€â”€â”€â”€â–ºâ”‚ Ollama Embedding â”‚          â”‚
â”‚   â”‚ (Tickets    â”‚     â”‚ (ProblÃ¨me +     â”‚     â”‚ (nomic-embed-    â”‚          â”‚
â”‚   â”‚  Clos)      â”‚     â”‚  Solution)      â”‚     â”‚  text: 768 dim)  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                        â”‚                    â”‚
â”‚                                                        â–¼                    â”‚
â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                                           â”‚   Postgres + pgvector  â”‚        â”‚
â”‚                                           â”‚   widip_knowledge_base â”‚        â”‚
â”‚                                           â”‚   (MÃ©moire vectorielle)â”‚        â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                        â”‚                    â”‚
â”‚   PHASE 2: CONSULTATION (MCP Memory - Temps rÃ©el)      â”‚                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                    â”‚
â”‚   â”‚ Agent IA    â”‚â”€â”€â”€â”€â–ºâ”‚ search_similar_ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚   â”‚ (Sentinel   â”‚     â”‚ cases(symptom)  â”‚                                   â”‚
â”‚   â”‚  ou Support)â”‚     â”‚                 â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                               â”‚                                             â”‚
â”‚                               â–¼                                             â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                 â”‚  "3 cas similaires trouvÃ©s:         â”‚                     â”‚
â”‚                 â”‚   - Ticket #4521 (89% similaire)    â”‚                     â”‚
â”‚                 â”‚   - Ticket #3892 (76% similaire)    â”‚                     â”‚
â”‚                 â”‚   Solution appliquÃ©e: Reset DNS"    â”‚                     â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Avant / AprÃ¨s

| Aspect | v6 (RÃ©actif) | v7 (ExpÃ©rimentÃ©) |
|--------|--------------|------------------|
| **Contexte** | Aucun historique | Consultation des prÃ©cÃ©dents similaires |
| **Diagnostic** | BasÃ© uniquement sur Observium | Enrichi par les solutions passÃ©es |
| **Temps de rÃ©solution** | Variable | OptimisÃ© grÃ¢ce Ã  l'expÃ©rience |
| **QualitÃ© des rÃ©ponses** | Standard | "Senior" - informÃ© par l'historique |
| **Apprentissage** | Aucun | Continu (chaque ticket clos enrichit la base) |

### 2.3 Composants techniques RAG

| Composant | RÃ´le | Technologie |
|-----------|------|-------------|
| **Embedding Model** | Vectorisation du texte | `nomic-embed-text` (768 dimensions) |
| **Vector Store** | Stockage des embeddings | PostgreSQL + `pgvector` |
| **Similarity Search** | Recherche sÃ©mantique | Cosine Distance (`<=>`) |
| **Ingestor** | Alimentation de la base | `WIDIP_RAG_Ingestor` (workflow n8n) |
| **MCP Memory** | Interface pour les agents | `WIDIP_MCP_Memory` (workflow n8n) |

---

## 3. Infrastructure bi-VM

### 3.1 Vue globale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INFRASTRUCTURE WIDIP v7                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚         VM1 - ORCHESTRATOR      â”‚    â”‚      VM2 - INSTANCE GPU        â”‚â”‚
â”‚   â”‚         (Docker Compose)        â”‚    â”‚         (Ollama)                â”‚â”‚
â”‚   â”‚                                 â”‚    â”‚                                 â”‚â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚
â”‚   â”‚  â”‚   n8n (Port 5678)       â”‚    â”‚    â”‚  â”‚   Ollama (Port 11434)   â”‚    â”‚â”‚
â”‚   â”‚  â”‚   - Workflows           â”‚â—„â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”‚   - qwen3-coder:30b     â”‚    â”‚â”‚
â”‚   â”‚  â”‚   - MCP Server          â”‚    â”‚    â”‚  â”‚   - nomic-embed-text    â”‚    â”‚â”‚
â”‚   â”‚  â”‚   - Agents IA           â”‚â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â–ºâ”‚                         â”‚    â”‚â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â”‚   GPU: NVIDIA L40S      â”‚    â”‚â”‚
â”‚   â”‚                                 â”‚    â”‚  â”‚   VRAM: 48GB            â”‚    â”‚â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â”‚
â”‚   â”‚  â”‚   Postgres + pgvector   â”‚    â”‚    â”‚                                 â”‚â”‚
â”‚   â”‚  â”‚   (Port 5432)           â”‚    â”‚    â”‚  âš ï¸ OLLAMA_HOST=0.0.0.0        â”‚â”‚
â”‚   â”‚  â”‚   - n8n DB              â”‚    â”‚    â”‚     (Ã‰coute rÃ©seau obligatoire) â”‚â”‚
â”‚   â”‚  â”‚   - widip_knowledge_baseâ”‚    â”‚    â”‚                                 â”‚â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚   â”‚                                 â”‚                                       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                       â”‚
â”‚   â”‚  â”‚   Redis (Port 6379)     â”‚    â”‚                                       â”‚
â”‚   â”‚  â”‚   - Mutex LLM           â”‚    â”‚                                       â”‚
â”‚   â”‚  â”‚   - Cache & Flags       â”‚    â”‚                                       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                       â”‚
â”‚   â”‚                                 â”‚                                       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                       â”‚
â”‚   â”‚  â”‚   Nginx (Port 8080)     â”‚    â”‚                                       â”‚
â”‚   â”‚  â”‚   - Cockpit Dashboard   â”‚    â”‚                                       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                       â”‚
â”‚   â”‚                                 â”‚                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 VM1 - Orchestrator (docker-compose.yml)

```yaml
version: '3.8'

services:
  # CÅ“ur d'Orchestration
  n8n:
    image: docker.n8n.io/n8nio/n8n
    restart: always
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=widip-orchestrator.local
      - N8N_PORT=5678
      - WEBHOOK_URL=http://widip-orchestrator.local:5678/
      - GENERIC_TIMEZONE=Europe/Paris
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=postgres
      - DB_POSTGRESDB_PORT=5432
      - DB_POSTGRESDB_DATABASE=n8n
      - DB_POSTGRESDB_USER=n8n
      - DB_POSTGRESDB_PASSWORD=secret_password
    volumes:
      - ./n8n_data:/home/node/.n8n
    depends_on:
      - postgres
      - redis

  # Base de donnÃ©es avec extension vectorielle
  postgres:
    image: pgvector/pgvector:pg16  # [NEW v7] Image avec pgvector
    restart: always
    environment:
      - POSTGRES_USER=n8n
      - POSTGRES_PASSWORD=secret_password
      - POSTGRES_DB=n8n
    volumes:
      - ./postgres_data:/var/lib/postgresql/data

  # Cache et synchronisation
  redis:
    image: redis:alpine
    restart: always
    command: redis-server --appendonly yes
    ports:
      - "6379:6379"

  # Dashboard Cockpit [NEW v7]
  dashboard:
    image: nginx:alpine
    volumes:
      - ./Dashboard/frontend:/usr/share/nginx/html
      - ./Dashboard/dashboard_v2.html:/usr/share/nginx/html/index.html
    ports:
      - "8080:80"
```

### 3.3 VM2 - Instance GPU (Ollama)

| ParamÃ¨tre | Valeur |
|-----------|--------|
| **OS** | Ubuntu 22.04 LTS |
| **GPU** | NVIDIA L40S (48GB VRAM) |
| **Driver** | nvidia-driver-535+ |
| **Runtime** | nvidia-container-toolkit |
| **Ollama Version** | Latest |
| **Ã‰coute** | `OLLAMA_HOST=0.0.0.0` (critique) |

**ModÃ¨les obligatoires :**

```bash
# ModÃ¨le principal - Raisonnement technique avancÃ©
ollama pull qwen3-coder:30b

# ModÃ¨le d'embedding - Vectorisation pour RAG [NEW v7]
ollama pull nomic-embed-text
```

### 3.4 Arborescence VM1

```
/opt/widip-orchestrator/
â”œâ”€â”€ INSTALL_VM1.md                 # Guide d'installation
â”œâ”€â”€ docker-compose.yml             # DÃ©finition des conteneurs
â”‚
â”œâ”€â”€ Dashboard/                     # Interface de Supervision
â”‚   â”œâ”€â”€ dashboard_v2.html          # Cockpit v8 (React-less)
â”‚   â”œâ”€â”€ WIDIP_Dashboard_Backend.json
â”‚   â”œâ”€â”€ index_test.html            # (Maquette - ignorer)
â”‚   â””â”€â”€ frontend/                  # (Legacy v1 - ignorer)
â”‚
â”œâ”€â”€ MCP/                           # "Model Context Protocol"
â”‚   â”œâ”€â”€ WIDIP_MCP_Server.json      # Hub Central
â”‚   â”œâ”€â”€ WIDIP_MCP_Memory.json      # [NEW v7] RAG
â”‚   â”œâ”€â”€ WIDIP_MCP_GLPI_v7.json     # [MAJ] + get_ticket_history
â”‚   â”œâ”€â”€ WIDIP_MCP_Observium.json   # Supervision
â”‚   â”œâ”€â”€ WIDIP_MCP_ActiveDirectory_v2.json
â”‚   â””â”€â”€ WIDIP_MCP_MySecret_v1.json
â”‚
â”œâ”€â”€ Workflow principaux/           # Agents Intelligents
â”‚   â”œâ”€â”€ WIDIP_Proactif_Observium_v9.json
â”‚   â”œâ”€â”€ WIDIP_Assist_ticket_v6.1.json
â”‚   â”œâ”€â”€ WIDIP_RAG_Ingestor.json    # [NEW v7]
â”‚   â”œâ”€â”€ WIDIP_Redis_Helper_v2.2.json
â”‚   â””â”€â”€ WIDIP_Health_Check_GLPI_v2.json
â”‚
â””â”€â”€ SQL/
    â””â”€â”€ init_vector_db.sql         # Extension pgvector + table
```

---

## 4. Vue d'ensemble de l'architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    WIDIP v7 - ARCHITECTURE COMPLÃˆTE                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                           VM1 - ORCHESTRATOR                          â”‚  â•‘
â•‘  â”‚                                                                       â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â•‘
â•‘  â”‚  â”‚ğŸ–¥ï¸ n8n          â”‚              â”‚ğŸ–¥ï¸ Cockpit      â”‚                     â”‚  â•‘
â•‘  â”‚  â”‚(Orchestration)â”‚              â”‚(Port 8080)    â”‚                     â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â•‘
â•‘  â”‚          â”‚                              â”‚                             â”‚  â•‘
â•‘  â”‚          â”‚ Workflows                    â”‚ HTTP API                    â”‚  â•‘
â•‘  â”‚          â–¼                              â–¼                             â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â•‘
â•‘  â”‚  â”‚ğŸ¥ Health Check â”‚              â”‚ğŸ“Š Dashboard    â”‚                     â”‚  â•‘
â•‘  â”‚  â”‚GLPI v2        â”‚              â”‚Backend        â”‚                     â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â•‘
â•‘  â”‚          â”‚                              â–²                             â”‚  â•‘
â•‘  â”‚          â”‚ Update health                â”‚ Stats, Mutex               â”‚  â•‘
â•‘  â”‚          â–¼                              â”‚                             â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â•‘
â•‘  â”‚  â”‚                    Redis DB                                â”‚      â”‚  â•‘
â•‘  â”‚  â”‚  â€¢ glpi_health_status        (TTL 60s)                     â”‚      â”‚  â•‘
â•‘  â”‚  â”‚  â€¢ llm_mutex                 (TTL 120-180s)                â”‚      â”‚  â•‘
â•‘  â”‚  â”‚  â€¢ observium_diag_*          (TTL 1200s)                   â”‚      â”‚  â•‘
â•‘  â”‚  â”‚  â€¢ diag_processed_*          (TTL 86400s)                  â”‚      â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â•‘
â•‘  â”‚                         â–²                                            â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â•‘
â•‘  â”‚  â”‚                                            â”‚                      â”‚  â•‘
â•‘  â”‚  â–¼                                            â–¼                      â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â•‘
â•‘  â”‚  â”‚ğŸš¨ PROACTIF v9     â”‚       â”‚ğŸ« ASSIST v6.1                  â”‚       â”‚  â•‘
â•‘  â”‚  â”‚                  â”‚       â”‚                                â”‚       â”‚  â•‘
â•‘  â”‚  â”‚ 2 Agents:        â”‚       â”‚ 2 Branches parallÃ¨les:         â”‚       â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ Sentinel v9    â”‚       â”‚ â€¢ Agent Support WIDIP          â”‚       â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ Notificateur   â”‚       â”‚ â€¢ Branche DIAG                 â”‚       â”‚  â•‘
â•‘  â”‚  â”‚                  â”‚       â”‚                                â”‚       â”‚  â•‘
â•‘  â”‚  â”‚ Si confiance<80%:â”‚       â”‚ DIAG Branch:                   â”‚       â”‚  â•‘
â•‘  â”‚  â”‚ â†’ Email outil    â”‚       â”‚ 1. DÃ©tecte #DIAG               â”‚       â”‚  â•‘
â•‘  â”‚  â”‚   diagnostic     â”‚       â”‚ 2. Parse format                â”‚       â”‚  â•‘
â•‘  â”‚  â”‚                  â”‚       â”‚ 3. Analyse responsabilitÃ©      â”‚       â”‚  â•‘
â•‘  â”‚  â”‚                  â”‚       â”‚ 4. Ajoute followup technique   â”‚       â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â•‘
â•‘  â”‚           â”‚                          â”‚                               â”‚  â•‘
â•‘  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚  â•‘
â•‘  â”‚                      â–¼                                               â”‚  â•‘
â•‘  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â•‘
â•‘  â”‚           â”‚   MCP WORKFLOWS (6 outils)         â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ§  MCP Memory [NEW v7]       â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_Memory)          â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  â†’ search_similar_cases()    â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  â†’ add_knowledge()           â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ“Š MCP Observium             â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_Observium)       â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ« MCP GLPI v7               â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_GLPI_v7)         â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  â†’ + get_ticket_history()    â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ‘¤ MCP Active Directory v2  â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_ActiveDirectory) â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ” MCP MySecret v1           â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_MySecret)        â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚                                    â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  ğŸ”— MCP Server (Hub)          â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â”‚  (WIDIP_MCP_Server)          â”‚  â”‚                     â”‚  â•‘
â•‘  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â•‘
â•‘  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â•‘
â•‘  â”‚                        â”‚                                             â”‚  â•‘
â•‘  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  â•‘
â•‘  â”‚           â–¼                         â–¼                                â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â•‘
â•‘  â”‚  â”‚ Postgres + pgvector â”‚   â”‚ GLPI DB (Externe)   â”‚                   â”‚  â•‘
â•‘  â”‚  â”‚ widip_knowledge_baseâ”‚   â”‚ (Lecture seule)     â”‚                   â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                           â”‚                                                 â•‘
â•‘                           â–¼                                                 â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸ¤– OLLAMA - VM2                                    â”‚  â•‘
â•‘  â”‚  ModÃ¨les:                                                            â”‚  â•‘
â•‘  â”‚  â€¢ qwen3-coder:30b (Raisonnement - 30B params)                       â”‚  â•‘
â•‘  â”‚  â€¢ nomic-embed-text (Embeddings RAG - 768 dim) [NEW v7]              â”‚  â•‘
â•‘  â”‚                                                                       â”‚  â•‘
â•‘  â”‚  GPU: NVIDIA L40S (48GB VRAM)                                        â”‚  â•‘
â•‘  â”‚  Performance: 20-30 tokens/sec                                       â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                           â”‚                                                 â•‘
â•‘              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â•‘
â•‘              â–¼            â–¼            â–¼                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ Observium API    â”‚ â”‚   GLPI API       â”‚ â”‚ Windows AD       â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 5. Les workflows principaux

### 5.1 Vue d'ensemble

| Workflow | Type | RÃ´le | Trigger |
|----------|------|------|---------|
| `WIDIP_Proactif_Observium_v9` | Agent | Surveillance proactive | Schedule (5min) |
| `WIDIP_Assist_ticket_v6.1` | Agent | Traitement tickets support | Schedule (3min) |
| `WIDIP_RAG_Ingestor` | Maintenance | Alimentation mÃ©moire RAG | Manuel/Cron |
| `WIDIP_Redis_Helper_v2.2` | Utilitaire | Abstraction Redis | Sub-workflow/Webhook |
| `WIDIP_Health_Check_GLPI_v2` | Utilitaire | Monitoring GLPI | Schedule (30s) |
| `WIDIP_Dashboard_Backend` | API | Backend Cockpit | Webhook |

### 5.2 WIDIP_Proactif_Observium_v9 (Agent Sentinel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PROACTIF OBSERVIUM v9 - FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ Schedule     â”‚                                                           â”‚
â”‚  â”‚ (5 minutes)  â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚ Redis: Check â”‚â”€â”€â”€â”€â–ºâ”‚ GLPI Health   â”‚                                     â”‚
â”‚  â”‚ glpi_health  â”‚     â”‚ OK ?          â”‚                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                               â”‚                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                    â”‚                     â”‚                                  â”‚
â”‚                    â–¼ OUI                 â–¼ NON                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚         â”‚ Acquire LLM Lock â”‚   â”‚ Skip Cycle       â”‚                         â”‚
â”‚         â”‚ (Mutex Redis)    â”‚   â”‚ (Log inactivitÃ©) â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                  â”‚                                                          â”‚
â”‚                  â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                     AGENT SENTINEL v9                             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  ModÃ¨le: qwen3-coder:30b                                          â”‚      â”‚
â”‚  â”‚  Outils: MCP Observium, MCP GLPI, MCP Memory [NEW v7]             â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  1. Interroge Observium (alertes actives)                         â”‚      â”‚
â”‚  â”‚  2. [NEW] Consulte MCP Memory (cas similaires)                    â”‚      â”‚
â”‚  â”‚  3. Analyse et dÃ©termine la responsabilitÃ©                        â”‚      â”‚
â”‚  â”‚  4. Si confiance >= 80% â†’ Action directe                          â”‚      â”‚
â”‚  â”‚  5. Si confiance < 80% â†’ Demande outil diagnostic                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                  â”‚                                                          â”‚
â”‚                  â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                     AGENT NOTIFICATEUR v9                         â”‚      â”‚
â”‚  â”‚                                                                   â”‚      â”‚
â”‚  â”‚  Si ticket crÃ©Ã©:                                                  â”‚      â”‚
â”‚  â”‚  â†’ Envoie email au client                                         â”‚      â”‚
â”‚  â”‚  â†’ Si confiance < 80%: Inclut lien DiagnosticWIDIP.exe            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                  â”‚                                                          â”‚
â”‚                  â–¼                                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚         â”‚ Release LLM Lock â”‚                                                â”‚
â”‚         â”‚ + Log Postgres   â”‚                                                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 WIDIP_Assist_ticket_v6.1 (Agent Support)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ASSIST TICKET v6.1 - FLOW                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ Schedule     â”‚                                                           â”‚
â”‚  â”‚ (3 minutes)  â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Initialiser: Check Redis (glpi_health_status)                   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ GLPI OK ?    â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚         â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ OUI                                     â”‚ NON                            â”‚
â”‚  â–¼                                         â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Acquire LLM Lockâ”‚              â”‚ Skip Cycle      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                                                 â”‚
â”‚           â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚                    DEUX BRANCHES PARALLÃˆLES                    â”‚         â”‚
â”‚  â”‚                                                                â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚  â”‚ BRANCHE AGENT       â”‚      â”‚ BRANCHE DIAG                â”‚  â”‚         â”‚
â”‚  â”‚  â”‚                     â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ Agent Support WIDIP â”‚      â”‚ 1. Chercher Followups #DIAG â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ (qwen3-coder:30b)   â”‚      â”‚ 2. Redis: DÃ©jÃ  traitÃ© ?     â”‚  â”‚         â”‚
â”‚  â”‚  â”‚                     â”‚      â”‚ 3. Parser format DIAG       â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ Outils:             â”‚      â”‚ 4. Analyser responsabilitÃ©  â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ MCP GLPI          â”‚      â”‚ 5. Ajouter followup GLPI    â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ MCP Memory [NEW]  â”‚      â”‚ 6. Redis: Marquer traitÃ©    â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ MCP AD            â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ MCP MySecret      â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚                     â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ Actions possibles:  â”‚      â”‚ Format attendu:             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ Reset MDP         â”‚      â”‚ #DIAG gw=ok int=fail        â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ Unlock compte     â”‚      â”‚      dns=ok ping=12ms       â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ CrÃ©er ticket      â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ â€¢ Escalader         â”‚      â”‚                             â”‚  â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â”‚            â”‚                                  â”‚                â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚                                  â”‚                          â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â–¼                                              â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚               â”‚ Merge + Consolider RÃ©sultats â”‚                              â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                              â–¼                                              â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚               â”‚ Release Lock + Log Postgres  â”‚                              â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 WIDIP_RAG_Ingestor (Alimentation mÃ©moire)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RAG INGESTOR - FLOW [NEW v7]                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ DÃ©marrage    â”‚  (Manuel ou Cron hebdomadaire)                            â”‚
â”‚  â”‚ Manuel/Bulk  â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Fetch GLPI Closed Tickets                                       â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚ SELECT id, name, content, solution_content                      â”‚       â”‚
â”‚  â”‚ FROM glpi_tickets                                               â”‚       â”‚
â”‚  â”‚ WHERE status = 6 (Clos)                                         â”‚       â”‚
â”‚  â”‚ AND solution_content IS NOT NULL                                â”‚       â”‚
â”‚  â”‚ ORDER BY date_mod DESC                                          â”‚       â”‚
â”‚  â”‚ LIMIT 100                                                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Format Text                                                     â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚ Pour chaque ticket:                                             â”‚       â”‚
â”‚  â”‚ - Nettoyer HTML                                                 â”‚       â”‚
â”‚  â”‚ - ConcatÃ©ner: "ProblÃ¨me: {title}\nDescription: {desc}\n         â”‚       â”‚
â”‚  â”‚                Solution: {solution}"                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Generate Embedding (Ollama - nomic-embed-text)                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚ POST http://widip-ai:11434/api/embeddings                       â”‚       â”‚
â”‚  â”‚ {                                                               â”‚       â”‚
â”‚  â”‚   "model": "nomic-embed-text",                                  â”‚       â”‚
â”‚  â”‚   "prompt": "{full_content}"                                    â”‚       â”‚
â”‚  â”‚ }                                                               â”‚       â”‚
â”‚  â”‚ â†’ Retourne vecteur 768 dimensions                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Save to Vector DB (Postgres + pgvector)                         â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚ INSERT INTO widip_knowledge_base                                â”‚       â”‚
â”‚  â”‚ (ticket_id, problem_summary, solution_summary,                  â”‚       â”‚
â”‚  â”‚  full_content, embedding)                                       â”‚       â”‚
â”‚  â”‚ VALUES (...)                                                    â”‚       â”‚
â”‚  â”‚ ON CONFLICT (ticket_id) DO NOTHING                              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 WIDIP_Redis_Helper_v2.2 (Abstraction Redis)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REDIS HELPER v2.2 - FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  DEUX POINTS D'ENTRÃ‰E:                                                      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Execute Workflow Triggerâ”‚    â”‚ Webhook POST            â”‚                 â”‚
â”‚  â”‚ (Appel interne n8n)     â”‚    â”‚ /redis-helper           â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚              â”‚                              â”‚                               â”‚
â”‚              â–¼                              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Normalize Execute Input â”‚    â”‚ Normalize Webhook Input â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚              â”‚                              â”‚                               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                             â–¼                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚              â”‚        Switch Action         â”‚                               â”‚
â”‚              â”‚                              â”‚                               â”‚
â”‚              â”‚  â€¢ GET    â†’ Redis GET        â”‚                               â”‚
â”‚              â”‚  â€¢ SET    â†’ Redis SET        â”‚                               â”‚
â”‚              â”‚  â€¢ DELETE â†’ Redis DELETE     â”‚                               â”‚
â”‚              â”‚  â€¢ SETNX  â†’ Atomic SETNX     â”‚                               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                             â”‚                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â–¼              â–¼              â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Redis GET     â”‚ â”‚ Redis SET     â”‚ â”‚ Redis Atomic SETNX  â”‚                â”‚
â”‚  â”‚ + Format      â”‚ â”‚ + Format      â”‚ â”‚ (SET key val NX EX) â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚              â”‚              â”‚              â”‚                                â”‚
â”‚              â–¼              â–¼              â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ If source == 'webhook' â†’ Respond HTTP 200 + JSON                â”‚        â”‚
â”‚  â”‚ If source == 'execute' â†’ Return JSON (sub-workflow)             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â”‚  SETNX (Mutex):                                                             â”‚
â”‚  - Atomique via commande custom: SET {key} {value} NX EX {ttl}              â”‚
â”‚  - Retourne: { success: true/false, message: "Lock acquired/held" }         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. SystÃ¨me MCP : les outils des agents

### 6.1 Architecture MCP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MCP (Model Context Protocol)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     WIDIP_MCP_Server (Hub)                          â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Expose des endpoints MCP Trigger pour chaque domaine:              â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ /mcp-memory â”‚ â”‚/mcp-observiumâ”‚ â”‚ /mcp-glpi   â”‚ â”‚ /mcp-ad     â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚         â”‚               â”‚               â”‚               â”‚           â”‚    â”‚
â”‚  â”‚         â–¼               â–¼               â–¼               â–¼           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚Call MCP     â”‚ â”‚Call MCP     â”‚ â”‚Call MCP     â”‚ â”‚Call MCP     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚Memory       â”‚ â”‚Observium    â”‚ â”‚GLPI         â”‚ â”‚AD           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚(toolWorkflow)â”‚ â”‚(toolWorkflow)â”‚ â”‚(toolWorkflow)â”‚ â”‚(toolWorkflow)â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚    â”‚
â”‚  â”‚  â”‚ /mcp-email  â”‚ â”‚/mcp-mysecretâ”‚                                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚    â”‚
â”‚  â”‚         â”‚               â”‚                                           â”‚    â”‚
â”‚  â”‚         â–¼               â–¼                                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚    â”‚
â”‚  â”‚  â”‚Call MCP     â”‚ â”‚Call MCP     â”‚                                    â”‚    â”‚
â”‚  â”‚  â”‚SMTP         â”‚ â”‚MySecret     â”‚                                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 MCP Memory (RAG) - [NEW v7]

| OpÃ©ration | Description | ParamÃ¨tres |
|-----------|-------------|------------|
| `search_similar_cases` | Recherche vectorielle de tickets similaires | `query` (string) |
| `add_knowledge` | Ajoute un ticket Ã  la base (future) | `ticket_id`, `content`, ... |

**Flux interne:**

```
search_similar_cases(query)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Embed Query (Ollama - nomic-embed-text)                     â”‚
â”‚    POST http://widip-ai:11434/api/embeddings                   â”‚
â”‚    â†’ Vecteur 768 dimensions                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Vector Search (Postgres + pgvector)                         â”‚
â”‚                                                                â”‚
â”‚    SELECT ticket_id, problem_summary, solution_summary,        â”‚
â”‚           1 - (embedding <=> '{query_vector}'::vector)         â”‚
â”‚           as similarity                                        â”‚
â”‚    FROM widip_knowledge_base                                   â”‚
â”‚    WHERE similarity > 0.6                                      â”‚
â”‚    ORDER BY similarity DESC                                    â”‚
â”‚    LIMIT 3                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Format Results                                              â”‚
â”‚                                                                â”‚
â”‚    {                                                           â”‚
â”‚      "knowledge_found": true,                                  â”‚
â”‚      "count": 3,                                               â”‚
â”‚      "cases": [                                                â”‚
â”‚        { "ticket": "4521", "similarity": "89%", ... },         â”‚
â”‚        { "ticket": "3892", "similarity": "76%", ... },         â”‚
â”‚        ...                                                     â”‚
â”‚      ]                                                         â”‚
â”‚    }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 MCP GLPI v7

| OpÃ©ration | Description | ParamÃ¨tres |
|-----------|-------------|------------|
| `search_new_tickets` | Liste tickets rÃ©cents | `minutes_since`, `limit` |
| `get_ticket_details` | DÃ©tails d'un ticket | `ticket_id` |
| `add_ticket_followup` | Ajoute un suivi | `ticket_id`, `content`, `is_private` |
| `close_ticket` | Ferme un ticket | `ticket_id`, `solution` |
| `search_client` | Recherche client | `name`, `email`, `phone` |
| `create_ticket` | CrÃ©e un ticket | `title`, `description`, `client_name`, ... |
| `get_ticket_history` | **[NEW v7]** Historique complet | `ticket_id` |

### 6.4 MCP Observium

| OpÃ©ration | Description | ParamÃ¨tres |
|-----------|-------------|------------|
| `get_device_status` | Ã‰tat d'un Ã©quipement | `device_name` ou `ip_address` |
| `get_device_metrics` | MÃ©triques rÃ©seau | `device_name`, `hours` |
| `get_device_alerts` | Alertes actives | `device_name`, `status` |
| `get_device_history` | Historique alertes | `device_name`, `hours` |

### 6.5 MCP Active Directory v2

| OpÃ©ration | Description | ParamÃ¨tres |
|-----------|-------------|------------|
| `check_user` | VÃ©rifie existence utilisateur | `username` |
| `get_user_info` | Informations dÃ©taillÃ©es | `username` |
| `reset_password` | RÃ©initialise mot de passe | `username`, `new_password` |
| `unlock_account` | DÃ©bloque compte verrouillÃ© | `username` |
| `create_user` | CrÃ©e un nouvel utilisateur | `username`, `email`, `firstname`, `lastname` |
| `disable_user` | DÃ©sactive un compte | `username` |

### 6.6 MCP MySecret v1

| OpÃ©ration | Description | ParamÃ¨tres |
|-----------|-------------|------------|
| `create_secret` | CrÃ©e un lien sÃ©curisÃ© Ã©phÃ©mÃ¨re | `payload`, `expire_days`, `expire_views` |

**Exemple de retour:**
```json
{
  "success": true,
  "secret_url": "https://mysecret.widip.fr/p/abc123xyz",
  "expires_in_days": 7,
  "expires_after_views": 5
}
```

---

## 7. Redis : mÃ©moire partagÃ©e et synchronisation

### 7.1 ClÃ©s utilisÃ©es

| ClÃ© | TTL | Usage |
|-----|-----|-------|
| `llm_mutex` | 120-180s | Exclusion mutuelle pour l'accÃ¨s au LLM |
| `glpi_health_status` | 60s | Ã‰tat de santÃ© GLPI (ok/degraded/down) |
| `glpi_down_alert_sent` | - | Flag anti-spam alertes GLPI down |
| `observium_diag_{device}` | 1200s | Cache diagnostic Observium |
| `diag_processed_{ticket_id}_{hash}` | 86400s | Anti-doublon traitement DIAG |

### 7.2 Mutex LLM (Exclusion mutuelle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MUTEX LLM - FONCTIONNEMENT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PROBLÃˆME: Ollama (VM2) ne peut traiter qu'une requÃªte Ã  la fois           â”‚
â”‚            efficacement. Deux agents concurrents = dÃ©gradation.            â”‚
â”‚                                                                             â”‚
â”‚  SOLUTION: Mutex distribuÃ© via Redis (SETNX atomique)                      â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Agent Sentinel  â”‚                    â”‚ Agent Support   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                                      â”‚                          â”‚
â”‚           â”‚ SETNX llm_mutex                      â”‚ SETNX llm_mutex          â”‚
â”‚           â”‚ "sentinel_v9_{exec_id}"              â”‚ "support_v6_{exec_id}"   â”‚
â”‚           â”‚ TTL=180s                             â”‚ TTL=180s                 â”‚
â”‚           â–¼                                      â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚                         REDIS                                   â”‚        â”‚
â”‚  â”‚                                                                 â”‚        â”‚
â”‚  â”‚  Commande atomique: SET llm_mutex {value} NX EX 180             â”‚        â”‚
â”‚  â”‚                                                                 â”‚        â”‚
â”‚  â”‚  â€¢ Premier arrivÃ© â†’ success: true, "Lock acquired"              â”‚        â”‚
â”‚  â”‚  â€¢ Suivants       â†’ success: false, "Lock held by another"      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                                      â”‚                          â”‚
â”‚           â–¼                                      â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ âœ… AccÃ¨s LLM     â”‚                    â”‚ â³ Polling       â”‚                 â”‚
â”‚  â”‚ (Traitement)    â”‚                    â”‚ (500ms loop)    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ Max 90s wait    â”‚                 â”‚
â”‚           â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚ DELETE llm_mutex                     â”‚                          â”‚
â”‚           â”‚ (Release)                            â”‚                          â”‚
â”‚           â–¼                                      â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚                          â”‚
â”‚  â”‚ ğŸ”“ Lock libÃ©rÃ©   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 AccÃ¨s via Redis Helper

**Depuis un workflow n8n (Execute Sub-Workflow):**
```javascript
// Acquire lock
const result = await $executeWorkflow("WIDIP_Redis_Helper_v2.2", {
  action: "setnx",
  key: "llm_mutex",
  value: `agent_${$execution.id}`,
  ttl: 180
});

if (result.success) {
  // Lock acquired, proceed
}
```

**Depuis l'extÃ©rieur (HTTP):**
```bash
curl -X POST http://localhost:5678/webhook/redis-helper \
  -H "Content-Type: application/json" \
  -d '{"action": "setnx", "key": "llm_mutex", "value": "external", "ttl": 60}'
```

---

## 8. Dashboard Backend API

### 8.1 Vue d'ensemble

Le workflow `WIDIP_Dashboard_Backend` expose une API REST pour le Cockpit WIDIP.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DASHBOARD BACKEND - ENDPOINTS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  GET /webhook/dashboard/stats                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  Retourne les statistiques du jour et l'Ã©tat du systÃ¨me.                   â”‚
â”‚                                                                             â”‚
â”‚  Response:                                                                  â”‚
â”‚  {                                                                          â”‚
â”‚    "timestamp": "2025-12-12T10:30:00Z",                                    â”‚
â”‚    "status": "operational",                                                â”‚
â”‚    "mutex": {                                                              â”‚
â”‚      "locked": false,                                                      â”‚
â”‚      "holder": null                                                        â”‚
â”‚    },                                                                       â”‚
â”‚    "kpi": {                                                                 â”‚
â”‚      "total_requests": 42,                                                 â”‚
â”‚      "success_rate": 95,                                                   â”‚
â”‚      "avg_duration": 12.3,                                                 â”‚
â”‚      "errors": 2                                                           â”‚
â”‚    },                                                                       â”‚
â”‚    "responsibility": {                                                      â”‚
â”‚      "fai": 8,                                                             â”‚
â”‚      "local": 12,                                                          â”‚
â”‚      "widip": 22                                                           â”‚
â”‚    }                                                                        â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  POST /webhook/dashboard/action                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  Actions administratives sur le systÃ¨me.                                   â”‚
â”‚                                                                             â”‚
â”‚  Body: { "action": "unlock_mutex" }                                        â”‚
â”‚                                                                             â”‚
â”‚  Response:                                                                  â”‚
â”‚  {                                                                          â”‚
â”‚    "success": true,                                                        â”‚
â”‚    "message": "Mutex forced unlocked successfully"                         â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  Headers CORS:                                                              â”‚
â”‚  Access-Control-Allow-Origin: *                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Flow interne

```
GET /stats
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Postgres Query    â”‚      â”‚ Redis GET         â”‚
â”‚ (widip_agent_logs)â”‚      â”‚ (llm_mutex)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Format Stats (Code) â”‚
          â”‚ - Calcul KPIs       â”‚
          â”‚ - Parse mutex       â”‚
          â”‚ - Build response    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Respond JSON + CORS â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Exemple complet de bout en bout

### 9.1 ScÃ©nario : Panne rÃ©seau avec consultation RAG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SCÃ‰NARIO v7 : PANNE RÃ‰SEAU AVEC MÃ‰MOIRE RAG                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  T+0min : DÃ‰TECTION                                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                        â”‚
â”‚  Observium dÃ©tecte: "Device EHPAD-LYON-GW unreachable"                     â”‚
â”‚  â†’ Webhook vers n8n                                                        â”‚
â”‚                                                                             â”‚
â”‚  T+1min : PROACTIF v9 SE RÃ‰VEILLE                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚  1. Check Redis: glpi_health_status = "ok" âœ“                               â”‚
â”‚  2. Acquire LLM Lock: success âœ“                                            â”‚
â”‚                                                                             â”‚
â”‚  T+2min : AGENT SENTINEL v9                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚  L'agent reÃ§oit l'alerte et commence l'analyse:                            â”‚
â”‚                                                                             â”‚
â”‚  [Agent] Je vais analyser cette panne rÃ©seau.                              â”‚
â”‚                                                                             â”‚
â”‚  [Tool Call] MCP Observium â†’ get_device_alerts("EHPAD-LYON-GW")            â”‚
â”‚  [Result] {                                                                â”‚
â”‚    "device": "EHPAD-LYON-GW",                                              â”‚
â”‚    "alerts": [                                                             â”‚
â”‚      { "type": "device_down", "duration": "5min" },                        â”‚
â”‚      { "type": "port_down", "port": "Gi0/1", "duration": "5min" }          â”‚
â”‚    ]                                                                       â”‚
â”‚  }                                                                         â”‚
â”‚                                                                             â”‚
â”‚  [Tool Call] MCP Memory â†’ search_similar_cases(                            â”‚  â—„â”€ [NEW v7]
â”‚    "EHPAD gateway unreachable port down Gi0/1"                             â”‚
â”‚  )                                                                          â”‚
â”‚  [Result] {                                                                â”‚
â”‚    "knowledge_found": true,                                                â”‚
â”‚    "cases": [                                                              â”‚
â”‚      {                                                                     â”‚
â”‚        "ticket": "4521",                                                   â”‚
â”‚        "similarity": "87%",                                                â”‚
â”‚        "problem": "EHPAD-MARSEILLE-GW unreachable",                        â”‚
â”‚        "solution": "ProblÃ¨me FAI Orange - Intervention sur la boucle      â”‚
â”‚                     locale. RÃ©solu aprÃ¨s contact FAI."                     â”‚
â”‚      },                                                                    â”‚
â”‚      {                                                                     â”‚
â”‚        "ticket": "3102",                                                   â”‚
â”‚        "similarity": "72%",                                                â”‚
â”‚        "problem": "Gateway clinique down aprÃ¨s orage",                     â”‚
â”‚        "solution": "Switch local grillÃ© - Remplacement matÃ©riel."          â”‚
â”‚      }                                                                     â”‚
â”‚    ]                                                                       â”‚
â”‚  }                                                                         â”‚
â”‚                                                                             â”‚
â”‚  [Agent] D'aprÃ¨s mes prÃ©cÃ©dents similaires (87% match avec ticket #4521),  â”‚
â”‚          ce type de panne est souvent liÃ© au FAI. Cependant, je n'ai pas   â”‚
â”‚          assez d'Ã©lÃ©ments pour confirmer (confiance: 65%).                 â”‚
â”‚          Je vais crÃ©er un ticket et demander un diagnostic client.         â”‚
â”‚                                                                             â”‚
â”‚  [Tool Call] MCP GLPI â†’ create_ticket({                                    â”‚
â”‚    title: "[AUTO] Panne rÃ©seau EHPAD-LYON-GW",                             â”‚
â”‚    description: "Alerte Observium: Gateway unreachable depuis 5min.\n      â”‚
â”‚                  Port Gi0/1 down.\n\n                                      â”‚
â”‚                  ğŸ“Š Analyse IA (confiance 65%):\n                          â”‚
â”‚                  Cas similaires trouvÃ©s:\n                                 â”‚
â”‚                  - #4521 (87%): ProblÃ¨me FAI rÃ©solu par contact Orange\n   â”‚
â”‚                  - #3102 (72%): Switch local dÃ©faillant\n\n                â”‚
â”‚                  âš ï¸ Diagnostic client requis pour confirmer.",             â”‚
â”‚    priority: 4                                                             â”‚
â”‚  })                                                                        â”‚
â”‚  [Result] { "ticket_id": 5678 }                                            â”‚
â”‚                                                                             â”‚
â”‚  T+3min : AGENT NOTIFICATEUR v9                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚  [Agent] Confiance < 80%, j'inclus le lien vers l'outil diagnostic.        â”‚
â”‚                                                                             â”‚
â”‚  [Tool Call] MCP SMTP â†’ send_email({                                       â”‚
â”‚    to: "contact@ehpad-lyon.fr",                                            â”‚
â”‚    subject: "ğŸš¨ Incident rÃ©seau dÃ©tectÃ© - Action requise",                 â”‚
â”‚    body: "Bonjour,\n\n                                                     â”‚
â”‚           Nous avons dÃ©tectÃ© une panne sur votre connexion.\n              â”‚
â”‚           Ticket ouvert: #5678\n\n                                         â”‚
â”‚           Pour accÃ©lÃ©rer le diagnostic, merci de:\n                        â”‚
â”‚           1. TÃ©lÃ©charger: https://widip.fr/diagnostic.exe\n                â”‚
â”‚           2. ExÃ©cuter l'outil\n                                            â”‚
â”‚           3. Nous transmettre le code gÃ©nÃ©rÃ©\n\n                           â”‚
â”‚           Cordialement,\n                                                  â”‚
â”‚           L'Ã©quipe WIDIP"                                                  â”‚
â”‚  })                                                                        â”‚
â”‚                                                                             â”‚
â”‚  T+4min : RELEASE LOCK + LOG                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                               â”‚
â”‚  1. Redis DELETE llm_mutex                                                 â”‚
â”‚  2. INSERT INTO widip_agent_logs (...)                                     â”‚
â”‚                                                                             â”‚
â”‚  T+15min : CLIENT RÃ‰POND (DIAG)                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚
â”‚  Le client exÃ©cute l'outil et rÃ©pond au ticket:                            â”‚
â”‚  "#DIAG gw=fail int=ok dns=fail ping=timeout"                              â”‚
â”‚                                                                             â”‚
â”‚  T+18min : ASSIST v6.1 - BRANCHE DIAG                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                     â”‚
â”‚  1. DÃ©tecte le followup #DIAG sur ticket 5678                              â”‚
â”‚  2. Redis: diag_processed_5678_{hash} n'existe pas                         â”‚
â”‚  3. Parse: gw=FAIL, int=OK, dns=FAIL, ping=TIMEOUT                         â”‚
â”‚  4. Analyse:                                                               â”‚
â”‚     - Gateway fail + DNS fail + ping timeout                               â”‚
â”‚     - Internet local OK                                                    â”‚
â”‚     â†’ ResponsabilitÃ©: FAI (95% confiance)                                  â”‚
â”‚  5. Ajoute followup technique:                                             â”‚
â”‚     "ğŸ“Š Analyse automatique DIAG:\n                                        â”‚
â”‚      Gateway: âŒ FAIL\n                                                     â”‚
â”‚      Internet local: âœ… OK\n                                                â”‚
â”‚      DNS: âŒ FAIL\n                                                         â”‚
â”‚      Ping: âŒ TIMEOUT\n\n                                                   â”‚
â”‚      ğŸ¯ ResponsabilitÃ©: FAI (95%)\n                                        â”‚
â”‚      Recommandation: Contacter Orange pour signalement incident."          â”‚
â”‚  6. Redis: SET diag_processed_5678_{hash} TTL=86400                        â”‚
â”‚                                                                             â”‚
â”‚  RÃ‰SULTAT FINAL                                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                            â”‚
â”‚  âœ… Ticket crÃ©Ã© avec contexte historique (RAG)                              â”‚
â”‚  âœ… Client notifiÃ© avec demande de diagnostic                               â”‚
â”‚  âœ… Diagnostic reÃ§u et analysÃ© automatiquement                              â”‚
â”‚  âœ… ResponsabilitÃ© FAI dÃ©terminÃ©e (95%)                                     â”‚
â”‚  âœ… Technicien peut contacter Orange directement                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Credentials et sÃ©curitÃ©

### 10.1 Credentials n8n requis

| Nom | Type | Usage |
|-----|------|-------|
| `Postgres Local` | PostgreSQL | DB n8n + widip_knowledge_base |
| `GLPI Database` | PostgreSQL | Lecture tickets GLPI (RAG Ingestor) |
| `WIDIP Redis` | Redis | Cache et mutex |
| `WIDIP GLPI API` | HTTP Header Auth | API REST GLPI |
| `WIDIP Phibee` | HTTP Header Auth | Authentification MCP |
| `Ollama` | HTTP Request | Connexion VM2 |

### 10.2 Configuration Ollama (VM2)

```bash
# /etc/systemd/system/ollama.service.d/override.conf
[Service]
Environment="OLLAMA_HOST=0.0.0.0"   # CRITIQUE: Ã‰coute rÃ©seau
Environment="OLLAMA_ORIGINS=*"       # Autorise toutes les origines
```

### 10.3 SÃ©curitÃ© rÃ©seau

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLUX RÃ‰SEAU WIDIP v7                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  EXPOSÃ‰S (Firewall ouvert):                                                â”‚
â”‚  â€¢ VM1:5678  (n8n) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Admin uniquement                         â”‚
â”‚  â€¢ VM1:8080  (Cockpit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º RÃ©seau interne                           â”‚
â”‚  â€¢ VM2:11434 (Ollama) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º VM1 uniquement                           â”‚
â”‚                                                                             â”‚
â”‚  INTERNES (Docker network):                                                â”‚
â”‚  â€¢ postgres:5432                                                           â”‚
â”‚  â€¢ redis:6379                                                              â”‚
â”‚                                                                             â”‚
â”‚  SORTANTS:                                                                  â”‚
â”‚  â€¢ API GLPI (HTTPS)                                                        â”‚
â”‚  â€¢ API Observium (HTTP)                                                    â”‚
â”‚  â€¢ LDAP/AD (389/636)                                                       â”‚
â”‚  â€¢ SMTP (587)                                                              â”‚
â”‚  â€¢ MySecret API (HTTPS)                                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. DÃ©ploiement

### 11.1 Ordre d'importation des workflows (CRITIQUE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ORDRE D'IMPORTATION n8n                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  GROUPE 1 : Infrastructure (Activer immÃ©diatement)                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚  1. WIDIP_MCP_Server.json            â† Hub central                         â”‚
â”‚  2. WIDIP_Redis_Helper_v2.2.json     â† Abstraction Redis                   â”‚
â”‚  3. WIDIP_Dashboard_Backend.json     â† API Cockpit                         â”‚
â”‚                                                                             â”‚
â”‚  GROUPE 2 : Outils MCP                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  4. WIDIP_MCP_Memory.json            â† RAG [NEW v7]                        â”‚
â”‚  5. WIDIP_MCP_GLPI_v7.json           â† Tickets                             â”‚
â”‚  6. WIDIP_MCP_Observium.json         â† Supervision                         â”‚
â”‚  7. WIDIP_MCP_ActiveDirectory_v2.json                                      â”‚
â”‚  8. WIDIP_MCP_MySecret_v1.json                                             â”‚
â”‚                                                                             â”‚
â”‚  GROUPE 3 : Agents (Activer aprÃ¨s tests)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚  9. WIDIP_Proactif_Observium_v9.json â† Agent Sentinel                      â”‚
â”‚  10. WIDIP_Assist_ticket_v6.1.json   â† Agent Support                       â”‚
â”‚                                                                             â”‚
â”‚  GROUPE 4 : Utilitaires                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  11. WIDIP_Health_Check_GLPI_v2.json â† Monitoring                          â”‚
â”‚  12. WIDIP_RAG_Ingestor.json         â† Lancer manuellement 1x              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 Initialisation base vectorielle

```sql
-- SQL/init_vector_db.sql
-- ExÃ©cuter une fois aprÃ¨s le premier dÃ©marrage Postgres

-- Active l'extension pgvector
CREATE EXTENSION IF NOT EXISTS vector;

-- Table de mÃ©moire RAG
CREATE TABLE IF NOT EXISTS widip_knowledge_base (
    id SERIAL PRIMARY KEY,
    ticket_id VARCHAR(50) UNIQUE,
    problem_summary TEXT,
    solution_summary TEXT,
    full_content TEXT,
    embedding vector(768),  -- Dimension nomic-embed-text
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSONB
);

-- Index pour recherche rapide (optionnel, efficace avec >1000 lignes)
-- CREATE INDEX ON widip_knowledge_base 
--   USING ivfflat (embedding vector_cosine_ops) 
--   WITH (lists = 100);
```

```bash
# Commande d'exÃ©cution
docker compose exec -T postgres psql -U n8n -d n8n < SQL/init_vector_db.sql
```

### 11.3 VÃ©rification post-dÃ©ploiement

```bash
# 1. VÃ©rifier les conteneurs
docker ps
# Attendu: n8n, postgres, redis, dashboard (4 UP)

# 2. Tester l'extension pgvector
docker compose exec postgres psql -U n8n -d n8n -c "SELECT extname FROM pg_extension WHERE extname='vector';"
# Attendu: vector

# 3. Tester la connexion Ollama (depuis VM1)
curl http://<IP_VM2>:11434/api/tags
# Attendu: Liste des modÃ¨les (qwen3-coder:30b, nomic-embed-text)

# 4. AccÃ©der au Cockpit
# http://<IP_VM1>:8080
# Attendu: Interface WIDIP Cockpit, statut mutex VERT
```

---

## 12. Changelog v6 â†’ v7

### 12.1 NouveautÃ©s majeures

| Composant | Changement | Impact |
|-----------|------------|--------|
| **MCP Memory** | Nouveau workflow RAG | Les agents consultent l'historique avant d'agir |
| **PostgreSQL** | `pgvector/pgvector:pg16` | Support recherche vectorielle native |
| **Ollama** | + `nomic-embed-text` | GÃ©nÃ©ration embeddings pour RAG |
| **Ollama** | `qwen3-coder:30b` | Meilleur raisonnement technique |
| **MCP GLPI** | + `get_ticket_history` | Lecture historique complet d'un ticket |
| **Dashboard** | Conteneur Nginx | Cockpit servi indÃ©pendamment |
| **Architecture** | VM2: `OLLAMA_HOST=0.0.0.0` | Ã‰coute rÃ©seau documentÃ©e obligatoire |

### 12.2 Workflows modifiÃ©s

| Workflow | Modification |
|----------|--------------|
| `WIDIP_Proactif_Observium_v9` | Ajout MCP Memory dans les tools |
| `WIDIP_Assist_ticket_v6.1` | Ajout MCP Memory dans les tools |
| `WIDIP_MCP_Server` | Nouveau endpoint `/mcp-memory` |

### 12.3 Nouveaux fichiers

```
+ SQL/init_vector_db.sql
+ MCP/WIDIP_MCP_Memory.json
+ Workflow principaux/WIDIP_RAG_Ingestor.json
```

### 12.4 Migration depuis v6

1. **Mettre Ã  jour l'image Postgres** dans `docker-compose.yml`:
   ```yaml
   postgres:
     image: pgvector/pgvector:pg16  # Ã‰tait: postgres:16
   ```

2. **RecrÃ©er le conteneur Postgres** (attention: backup d'abord):
   ```bash
   docker compose down postgres
   docker compose up -d postgres
   ```

3. **ExÃ©cuter le script SQL**:
   ```bash
   docker compose exec -T postgres psql -U n8n -d n8n < SQL/init_vector_db.sql
   ```

4. **Installer le modÃ¨le embedding sur VM2**:
   ```bash
   ollama pull nomic-embed-text
   ```

5. **Mettre Ã  jour le modÃ¨le principal** (optionnel mais recommandÃ©):
   ```bash
   ollama pull qwen3-coder:30b
   ```

6. **Importer les nouveaux workflows** dans l'ordre du Â§11.1

7. **ExÃ©cuter RAG Ingestor** manuellement pour charger l'historique initial

---

## Annexe A : Table des workflows et noms

> **Note**: Les IDs n8n changent Ã  chaque import. Utiliser les **noms** pour les rÃ©fÃ©rences.

| Nom du Workflow | Type | Doit Ãªtre activÃ© |
|-----------------|------|------------------|
| `WIDIP_MCP_Server` | MCP Hub | âœ… Oui |
| `WIDIP_MCP_Memory` | MCP Tool | Non (appelÃ©) |
| `WIDIP_MCP_GLPI_v7` | MCP Tool | Non (appelÃ©) |
| `WIDIP_MCP_Observium` | MCP Tool | Non (appelÃ©) |
| `WIDIP_MCP_ActiveDirectory_v2` | MCP Tool | Non (appelÃ©) |
| `WIDIP_MCP_MySecret_v1` | MCP Tool | Non (appelÃ©) |
| `WIDIP_Redis_Helper_v2.2` | Utilitaire | âœ… Oui |
| `WIDIP_Dashboard_Backend` | API | âœ… Oui |
| `WIDIP_Health_Check_GLPI_v2` | Monitoring | âœ… Oui |
| `WIDIP_Proactif_Observium_v9` | Agent | âœ… Oui (aprÃ¨s tests) |
| `WIDIP_Assist_ticket_v6.1` | Agent | âœ… Oui (aprÃ¨s tests) |
| `WIDIP_RAG_Ingestor` | Maintenance | Non (manuel) |

---

**Document crÃ©Ã© le 12 dÃ©cembre 2025**  
**Architecture v7**

---

> **AVIS DE PROPRIÃ‰TÃ‰ ET CONFIDENTIALITÃ‰**
> Ce document, ainsi que l'architecture technique, les workflows (n8n), les scripts et les mÃ©thodologies (notamment la "MÃ©moire RAG Active") qu'il dÃ©crit, sont la propriÃ©tÃ© exclusive de **WIDIP** et de son auteur **RIPOUTEAU Maxime**.
>
> Toute reproduction, distribution, modification ou utilisation non autorisÃ©e de tout ou partie de ce systÃ¨me sans accord Ã©crit prÃ©alable est strictement interdite. Ces informations sont confidentielles et protÃ©gÃ©es par le Code de la propriÃ©tÃ© intellectuelle.
>
> Â© WIDIP 2025 - Tous droits rÃ©servÃ©s.

---
